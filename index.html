<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shader Lab Pro 2.4.1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    :root {
      --bg-void:#050508;
      --bg-panel:#0a0a12;
      --bg-card:#0f0f1a;
      --accent-primary:#00ff88;
      --accent-secondary:#ff3366;
      --accent-tertiary:#ffaa00;
      --accent-cyan:#00e5ff;
      --accent-purple:#aa44ff;
      --text-dim:#5a5a7a;
      --text-mid:#8a8aaa;
      --text-light:#d0d0f0;
      --border:#1a1a2a;
      --glow-green:rgba(0,255,136,0.3);
      --glow-red:rgba(255,51,102,0.3);
      --glow-cyan:rgba(0,229,255,0.3);
    }
    body {
      font-family:'Rajdhani',sans-serif;
      background:var(--bg-void);
      color:var(--text-light);
      min-height:100vh;
      overflow:hidden;
    }
    .container {
      display:grid;
      grid-template-columns:1fr 420px;
      height:100vh;
    }
    .shader-view {
      position:relative;
      background:#000;
    }
    canvas {
      width:100%;
      height:100%;
      display:block;
    }
    .overlay-info {
      position:absolute;
      top:16px;
      left:16px;
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }
    .info-badge {
      background:rgba(0,0,0,0.85);
      backdrop-filter:blur(10px);
      padding:8px 14px;
      border-radius:8px;
      font-size:12px;
      font-weight:600;
      color:var(--accent-primary);
      border:1px solid var(--border);
      display:flex;
      align-items:center;
      gap:6px;
    }
    .info-badge .dot {
      width:8px;
      height:8px;
      border-radius:50%;
      background:var(--accent-primary);
      animation:pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%,100%{opacity:1;transform:scale(1);}
      50%{opacity:0.5;transform:scale(1.2);}
    }
    .preset-indicator {
      position:absolute;
      bottom:20px;
      left:20px;
      background:rgba(0,0,0,0.9);
      backdrop-filter:blur(10px);
      padding:14px 24px;
      border-radius:12px;
      border:1px solid var(--accent-primary);
      box-shadow:0 0 30px var(--glow-green);
    }
    .shader-type {
      font-family:'Orbitron',monospace;
      font-size:11px;
      color:var(--accent-cyan);
      letter-spacing:2px;
      margin-bottom:4px;
    }
    .preset-name {
      font-family:'Orbitron',monospace;
      font-size:20px;
      font-weight:700;
      color:var(--accent-primary);
      text-transform:uppercase;
      letter-spacing:2px;
    }
    .control-panel {
      background:var(--bg-panel);
      border-left:1px solid var(--border);
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    .panel-header {
      padding:14px 20px;
      background:linear-gradient(180deg,var(--bg-card),transparent);
      border-bottom:1px solid var(--border);
    }
    .panel-title {
      font-family:'Orbitron',monospace;
      font-size:18px;
      font-weight:900;
      letter-spacing:3px;
      background:linear-gradient(135deg,var(--accent-primary),var(--accent-secondary),var(--accent-cyan));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .panel-subtitle {
      font-size:10px;
      color:var(--text-dim);
      margin-top:3px;
      letter-spacing:1px;
    }
    .shader-selector {
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:6px;
      margin-top:10px;
    }
    .shader-btn {
      background:var(--bg-card);
      border:1px solid var(--border);
      border-radius:6px;
      padding:10px 6px;
      font-family:'Rajdhani',sans-serif;
      font-size:9px;
      font-weight:700;
      color:var(--text-mid);
      cursor:pointer;
      transition:all 0.2s ease;
      text-transform:uppercase;
      letter-spacing:0.3px;
    }
    .shader-btn:hover {
      border-color:var(--accent-cyan);
      color:var(--accent-cyan);
      box-shadow:0 0 15px var(--glow-cyan);
    }
    .shader-btn.active {
      background:linear-gradient(135deg,rgba(0,229,255,0.2),rgba(170,68,255,0.2));
      border-color:var(--accent-cyan);
      color:var(--accent-cyan);
      box-shadow:0 0 20px var(--glow-cyan);
    }
    .shader-btn.new-badge::after {
      content:"â˜…";
      margin-left:4px;
      color:var(--accent-tertiary);
    }
    .export-btn {
      margin-top:10px;
      width:100%;
      padding:10px;
      background:linear-gradient(135deg,var(--accent-primary),var(--accent-cyan));
      border:none;
      border-radius:8px;
      font-family:'Rajdhani',sans-serif;
      font-size:12px;
      font-weight:700;
      color:#000;
      cursor:pointer;
      text-transform:uppercase;
      letter-spacing:1px;
      transition:all 0.2s;
    }
    .export-btn:hover {
      box-shadow:0 0 25px var(--glow-green);
      transform:translateY(-1px);
    }
    .panel-scroll {
      flex:1;
      overflow-y:auto;
      padding:14px 18px;
    }
    .panel-scroll::-webkit-scrollbar {
      width:6px;
    }
    .panel-scroll::-webkit-scrollbar-track {
      background:var(--bg-void);
    }
    .panel-scroll::-webkit-scrollbar-thumb {
      background:var(--border);
      border-radius:3px;
    }
    .presets-grid {
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:5px;
      margin-bottom:14px;
    }
    .preset-btn {
      background:var(--bg-card);
      border:1px solid var(--border);
      border-radius:5px;
      padding:7px 4px;
      font-family:'Rajdhani',sans-serif;
      font-size:8px;
      font-weight:600;
      color:var(--text-mid);
      cursor:pointer;
      transition:all 0.2s ease;
      text-transform:uppercase;
      letter-spacing:0.2px;
    }
    .preset-btn:hover {
      background:var(--bg-void);
      border-color:var(--accent-primary);
      color:var(--accent-primary);
    }
    .preset-btn.active {
      background:linear-gradient(135deg,rgba(0,255,136,0.15),rgba(255,51,102,0.15));
      border-color:var(--accent-primary);
      color:var(--accent-primary);
      box-shadow:0 0 12px var(--glow-green);
    }
    .section-title {
      font-family:'Orbitron',monospace;
      font-size:8px;
      text-transform:uppercase;
      letter-spacing:2px;
      margin:14px 0 8px;
      color:var(--accent-secondary);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .section-title::before {
      content:"â—†";
      font-size:6px;
    }
    .section-title::after {
      content:"";
      flex:1;
      height:1px;
      background:linear-gradient(90deg,var(--accent-secondary),transparent);
    }
    .control-group {
      margin-bottom:10px;
    }
    .control-label {
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:10px;
      font-weight:600;
      margin-bottom:4px;
      color:var(--text-mid);
    }
    .control-value {
      font-family:'JetBrains Mono',monospace;
      font-size:9px;
      color:var(--accent-primary);
      min-width:40px;
      text-align:right;
    }
    .slider-track {
      position:relative;
      height:4px;
      background:var(--bg-void);
      border-radius:2px;
    }
    .slider-fill {
      position:absolute;
      left:0;top:0;
      height:100%;
      background:linear-gradient(90deg,var(--accent-primary),var(--accent-secondary));
      border-radius:2px;
      pointer-events:none;
    }
    input[type="range"] {
      -webkit-appearance:none;
      width:100%;
      height:4px;
      background:transparent;
      position:relative;
      z-index:2;
      cursor:pointer;
      margin:0;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance:none;
      width:14px;
      height:14px;
      border-radius:50%;
      background:var(--text-light);
      border:2px solid var(--accent-primary);
      box-shadow:0 0 8px var(--glow-green);
      cursor:grab;
    }
    .controls-section {
      display:none;
    }
    .controls-section.active {
      display:block;
    }
    .tip-box {
      margin-top:14px;
      padding:10px;
      background:var(--bg-card);
      border:1px solid var(--border);
      border-radius:6px;
      font-size:9px;
      color:var(--text-dim);
      line-height:1.4;
    }
    .tip-box strong {
      color:var(--accent-tertiary);
    }
    /* Modal */
    .modal-overlay {
      display:none;
      position:fixed;
      top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.9);
      z-index:1000;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .modal-overlay.active {
      display:flex;
    }
    .modal-content {
      background:var(--bg-panel);
      border:1px solid var(--accent-primary);
      border-radius:16px;
      max-width:800px;
      width:100%;
      max-height:80vh;
      display:flex;
      flex-direction:column;
      box-shadow:0 0 60px var(--glow-green);
    }
    .modal-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:16px 20px;
      border-bottom:1px solid var(--border);
    }
    .modal-title {
      font-family:'Orbitron',monospace;
      font-size:16px;
      font-weight:700;
      color:var(--accent-primary);
      letter-spacing:2px;
    }
    .modal-close {
      background:none;
      border:none;
      color:var(--text-dim);
      font-size:24px;
      cursor:pointer;
      padding:0 8px;
      transition:color 0.2s;
    }
    .modal-close:hover {
      color:var(--accent-secondary);
    }
    .modal-body {
      flex:1;
      overflow:auto;
    }
    .code-preview {
      background:var(--bg-void);
      color:#a0ffa0;
      font-family:'JetBrains Mono',monospace;
      font-size:10px;
      line-height:1.4;
      padding:16px;
      margin:0;
      white-space:pre;
      overflow:auto;
      min-height:250px;
    }
    .modal-footer {
      display:flex;
      gap:12px;
      padding:16px 20px;
      border-top:1px solid var(--border);
    }
    .modal-btn {
      flex:1;
      padding:12px 20px;
      border:none;
      border-radius:8px;
      font-family:'Rajdhani',sans-serif;
      font-size:13px;
      font-weight:700;
      cursor:pointer;
      transition:all 0.2s;
      text-transform:uppercase;
      letter-spacing:1px;
    }
    .modal-btn.primary {
      background:linear-gradient(135deg,var(--accent-primary),var(--accent-cyan));
      color:#000;
    }
    .modal-btn.primary:hover {
      box-shadow:0 0 20px var(--glow-green);
    }
    .modal-btn.secondary {
      background:var(--bg-card);
      color:var(--text-light);
      border:1px solid var(--border);
    }
    .modal-btn.secondary:hover {
      border-color:var(--accent-primary);
    }
    .copy-success {
      background:var(--accent-cyan) !important;
    }
    @media (max-width:900px){
      .container { 
        grid-template-columns:1fr; 
        grid-template-rows:40vh 1fr;
        height:100vh;
      }
      .control-panel { 
        border-left:none; 
        border-top:1px solid var(--border);
        overflow-y:auto;
      }
      .shader-view {
        min-height:200px;
      }
      .preset-indicator {
        bottom:10px;
        left:10px;
        padding:10px 16px;
      }
      .preset-name {
        font-size:16px;
      }
      .shader-type {
        font-size:9px;
      }
      .panel-header {
        padding:12px 16px;
      }
      .panel-title {
        font-size:16px;
      }
      .shader-selector {
        gap:5px;
        margin-top:8px;
      }
      .shader-btn {
        padding:8px 4px;
        font-size:8px;
      }
      .export-btn {
        margin-top:8px;
        padding:8px;
        font-size:10px;
      }
      .panel-scroll {
        padding:10px 14px;
      }
      .overlay-info {
        top:10px;
        left:10px;
        gap:8px;
      }
      .info-badge {
        padding:6px 10px;
        font-size:10px;
      }
    }
    @media (max-width:500px){
      .container { 
        grid-template-rows:35vh 1fr;
      }
      .shader-selector {
        grid-template-columns:repeat(2,1fr);
      }
      .presets-grid {
        grid-template-columns:repeat(3,1fr);
        gap:3px;
      }
      .preset-btn {
        padding:5px 2px;
        font-size:7px;
      }
      .control-group {
        margin-bottom:8px;
      }
      .section-title {
        margin:10px 0 6px;
        font-size:7px;
      }
    }
    /* Audio Player */
    .audio-controls {
      position:absolute;
      bottom:16px;
      right:16px;
      display:flex;
      align-items:center;
      gap:8px;
      background:rgba(10,10,18,0.85);
      padding:8px 12px;
      border-radius:20px;
      border:1px solid var(--border);
      z-index:100;
      backdrop-filter:blur(8px);
      opacity:0.6;
      transition:opacity 0.3s;
    }
    .audio-controls:hover {
      opacity:1;
    }
    .audio-btn {
      background:none;
      border:none;
      color:var(--text-mid);
      cursor:pointer;
      font-size:16px;
      padding:4px;
      transition:color 0.2s;
    }
    .audio-btn:hover {
      color:var(--accent-primary);
    }
    .audio-btn.playing {
      color:var(--accent-primary);
    }
    .volume-slider {
      width:60px;
      height:4px;
      -webkit-appearance:none;
      background:var(--border);
      border-radius:2px;
      cursor:pointer;
    }
    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance:none;
      width:12px;
      height:12px;
      background:var(--accent-primary);
      border-radius:50%;
      cursor:pointer;
    }
    .volume-slider::-moz-range-thumb {
      width:12px;
      height:12px;
      background:var(--accent-primary);
      border-radius:50%;
      cursor:pointer;
      border:none;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="shader-view">
    <canvas id="glCanvas"></canvas>
    <div class="overlay-info">
      <div class="info-badge"><span class="dot"></span> LIVE</div>
      <div class="info-badge">FPS: <span id="fps">60</span></div>
      <div class="info-badge" id="res-badge">1920Ã—1080</div>
    </div>
    <div class="preset-indicator">
      <div class="shader-type" id="shader-type">PLASMA VORTEX</div>
      <div class="preset-name" id="current-preset">ENERGY BURST</div>
    </div>
    <div class="audio-controls" id="audio-controls">
      <button class="audio-btn playing" id="audio-toggle" title="Play/Pause">ðŸ”Š</button>
      <input type="range" class="volume-slider" id="volume-slider" min="0" max="1" step="0.05" value="0.4">
    </div>
  </div>
  
  <div class="control-panel">
    <div class="panel-header">
      <h1 class="panel-title">SHADER LAB PRO</h1>
      <p class="panel-subtitle">Version 2.4.1 â€¢ 9 Epic Shaders</p>
      <div class="shader-selector">
        <button class="shader-btn active new-badge" data-shader="0">Plasma Vortex</button>
        <button class="shader-btn new-badge" data-shader="1">Cosmic Mandala</button>
        <button class="shader-btn new-badge" data-shader="2">Dark Transit</button>
        <button class="shader-btn new-badge" data-shader="3">Neon Grid</button>
        <button class="shader-btn new-badge" data-shader="4">Electric Arcs</button>
        <button class="shader-btn" data-shader="5">Neon Spokes</button>
        <button class="shader-btn" data-shader="6">Crystal Lattice</button>
        <button class="shader-btn" data-shader="7">Rainbow Nebula</button>
        <button class="shader-btn" data-shader="8">Inferno Fire</button>
      </div>
      <button class="export-btn" id="export-btn">Export to Shadertoy</button>
    </div>
    
    <div class="panel-scroll">
      <!-- â˜… PLASMA VORTEX CONTROLS (FIRST!) -->
      <div class="controls-section active" id="controls-0">
        <div class="section-title">Presets</div>
        <div class="presets-grid" id="presets-0"></div>
        
        <div class="section-title">Vortex</div>
        <div class="control-group">
          <div class="control-label"><span>Vortex Arms</span><span class="control-value" id="val-pv-arms">4</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-arms"></div>
          <input type="range" id="pv-arms" min="1" max="12" step="1" value="4"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Spin Speed</span><span class="control-value" id="val-pv-spin">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-spin"></div>
          <input type="range" id="pv-spin" min="0" max="3" step="0.02" value="1"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Spiral Tightness</span><span class="control-value" id="val-pv-tightness">3.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-tightness"></div>
          <input type="range" id="pv-tightness" min="0.5" max="8" step="0.1" value="3"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Core Size</span><span class="control-value" id="val-pv-coresize">0.20</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-coresize"></div>
          <input type="range" id="pv-coresize" min="0.05" max="0.8" step="0.01" value="0.2"></div>
        </div>
        
        <div class="section-title">Plasma</div>
        <div class="control-group">
          <div class="control-label"><span>Plasma Intensity</span><span class="control-value" id="val-pv-plasma">1.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-plasma"></div>
          <input type="range" id="pv-plasma" min="0.5" max="4" step="0.05" value="1.5"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Electric Tendrils</span><span class="control-value" id="val-pv-tendrils">0.80</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-tendrils"></div>
          <input type="range" id="pv-tendrils" min="0" max="2" step="0.02" value="0.8"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Noise Scale</span><span class="control-value" id="val-pv-noisescale">4.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-noisescale"></div>
          <input type="range" id="pv-noisescale" min="1" max="12" step="0.2" value="4"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Turbulence</span><span class="control-value" id="val-pv-turbulence">0.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-turbulence"></div>
          <input type="range" id="pv-turbulence" min="0" max="2" step="0.02" value="0.5"></div>
        </div>
        
        <div class="section-title">Energy</div>
        <div class="control-group">
          <div class="control-label"><span>Pulse Rate</span><span class="control-value" id="val-pv-pulserate">2.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-pulserate"></div>
          <input type="range" id="pv-pulserate" min="0" max="6" step="0.1" value="2"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Energy Waves</span><span class="control-value" id="val-pv-waves">3.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-waves"></div>
          <input type="range" id="pv-waves" min="0" max="8" step="0.2" value="3"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Wave Speed</span><span class="control-value" id="val-pv-wavespeed">1.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-wavespeed"></div>
          <input type="range" id="pv-wavespeed" min="0" max="4" step="0.05" value="1.5"></div>
        </div>
        
        <div class="section-title">Color</div>
        <div class="control-group">
          <div class="control-label"><span>Color Mode</span><span class="control-value" id="val-pv-colormode">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-colormode"></div>
          <input type="range" id="pv-colormode" min="0" max="3" step="0.1" value="1"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Hue Shift</span><span class="control-value" id="val-pv-hue">0.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-hue"></div>
          <input type="range" id="pv-hue" min="0" max="6.28" step="0.05" value="0"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Core Glow</span><span class="control-value" id="val-pv-coreglow">2.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-coreglow"></div>
          <input type="range" id="pv-coreglow" min="0" max="5" step="0.1" value="2"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Bloom</span><span class="control-value" id="val-pv-bloom">0.40</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-bloom"></div>
          <input type="range" id="pv-bloom" min="0" max="1" step="0.02" value="0.4"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Zoom</span><span class="control-value" id="val-pv-zoom">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-pv-zoom"></div>
          <input type="range" id="pv-zoom" min="0.3" max="3" step="0.05" value="1"></div>
        </div>
      </div>

      <!-- â˜… COSMIC MANDALA CONTROLS -->
      <div class="controls-section" id="controls-1">
        <div class="section-title">Presets</div>
        <div class="presets-grid" id="presets-1"></div>
        
        <div class="section-title">Geometry</div>
        <div class="control-group">
          <div class="control-label"><span>Symmetry</span><span class="control-value" id="val-cm-symmetry">6</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-symmetry"></div>
          <input type="range" id="cm-symmetry" min="3" max="16" step="1" value="6"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Layers</span><span class="control-value" id="val-cm-layers">5</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-layers"></div>
          <input type="range" id="cm-layers" min="2" max="10" step="1" value="5"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Complexity</span><span class="control-value" id="val-cm-complexity">3.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-complexity"></div>
          <input type="range" id="cm-complexity" min="1" max="8" step="0.1" value="3"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Ring Scale</span><span class="control-value" id="val-cm-ringscale">1.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-ringscale"></div>
          <input type="range" id="cm-ringscale" min="0.5" max="4" step="0.05" value="1.5"></div>
        </div>
        
        <div class="section-title">Motion</div>
        <div class="control-group">
          <div class="control-label"><span>Rotation Speed</span><span class="control-value" id="val-cm-rotspeed">0.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-rotspeed"></div>
          <input type="range" id="cm-rotspeed" min="0" max="2" step="0.02" value="0.5"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Pulse Speed</span><span class="control-value" id="val-cm-pulsespeed">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-pulsespeed"></div>
          <input type="range" id="cm-pulsespeed" min="0" max="4" step="0.05" value="1"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Pulse Amount</span><span class="control-value" id="val-cm-pulseamt">0.30</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-pulseamt"></div>
          <input type="range" id="cm-pulseamt" min="0" max="1" step="0.02" value="0.3"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Spiral Twist</span><span class="control-value" id="val-cm-spiral">0.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-spiral"></div>
          <input type="range" id="cm-spiral" min="-2" max="2" step="0.05" value="0"></div>
        </div>
        
        <div class="section-title">Glow &amp; Color</div>
        <div class="control-group">
          <div class="control-label"><span>Glow Intensity</span><span class="control-value" id="val-cm-glow">1.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-glow"></div>
          <input type="range" id="cm-glow" min="0.5" max="4" step="0.05" value="1.5"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Glow Falloff</span><span class="control-value" id="val-cm-falloff">2.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-falloff"></div>
          <input type="range" id="cm-falloff" min="0.5" max="5" step="0.1" value="2"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Color Cycle</span><span class="control-value" id="val-cm-colorcycle">0.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-colorcycle"></div>
          <input type="range" id="cm-colorcycle" min="0" max="2" step="0.02" value="0.5"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Hue Offset</span><span class="control-value" id="val-cm-hue">0.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-hue"></div>
          <input type="range" id="cm-hue" min="0" max="6.28" step="0.05" value="0"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Saturation</span><span class="control-value" id="val-cm-saturation">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-saturation"></div>
          <input type="range" id="cm-saturation" min="0" max="2" step="0.02" value="1"></div>
        </div>
        
        <div class="section-title">Effects</div>
        <div class="control-group">
          <div class="control-label"><span>Edge Glow</span><span class="control-value" id="val-cm-edgeglow">0.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-edgeglow"></div>
          <input type="range" id="cm-edgeglow" min="0" max="2" step="0.02" value="0.5"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Bloom</span><span class="control-value" id="val-cm-bloom">0.30</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-bloom"></div>
          <input type="range" id="cm-bloom" min="0" max="1" step="0.02" value="0.3"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Zoom</span><span class="control-value" id="val-cm-zoom">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cm-zoom"></div>
          <input type="range" id="cm-zoom" min="0.3" max="3" step="0.05" value="1"></div>
        </div>
      </div>

      <!-- â˜… DARK TRANSIT CONTROLS (NEW!) -->
      <div class="controls-section" id="controls-2">
        <div class="section-title">Presets</div>
        <div class="presets-grid" id="presets-2"></div>
        
        <div class="section-title">Tunnel</div>
        <div class="control-group">
          <div class="control-label"><span>Speed</span><span class="control-value" id="val-dt-speed">4.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-dt-speed"></div>
          <input type="range" id="dt-speed" min="0.5" max="12" step="0.1" value="4"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Radius</span><span class="control-value" id="val-dt-radius">4.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-dt-radius"></div>
          <input type="range" id="dt-radius" min="2" max="8" step="0.1" value="4"></div>
        </div>
        
        <div class="section-title">Detail</div>
        <div class="control-group">
          <div class="control-label"><span>Scoops</span><span class="control-value" id="val-dt-scoops">0.25</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-dt-scoops"></div>
          <input type="range" id="dt-scoops" min="0.05" max="0.6" step="0.01" value="0.25"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Detail</span><span class="control-value" id="val-dt-detail">0.22</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-dt-detail"></div>
          <input type="range" id="dt-detail" min="0.05" max="0.5" step="0.01" value="0.22"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Orb Glow</span><span class="control-value" id="val-dt-orb">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-dt-orb"></div>
          <input type="range" id="dt-orb" min="0" max="3" step="0.05" value="1"></div>
        </div>
        
        <div class="section-title">Color</div>
        <div class="control-group">
          <div class="control-label"><span>Brightness</span><span class="control-value" id="val-dt-brightness">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-dt-brightness"></div>
          <input type="range" id="dt-brightness" min="0.3" max="2.5" step="0.05" value="1"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Saturation</span><span class="control-value" id="val-dt-saturation">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-dt-saturation"></div>
          <input type="range" id="dt-saturation" min="0.2" max="2" step="0.05" value="1"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>BG Darkness</span><span class="control-value" id="val-dt-bgdark">0.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-dt-bgdark"></div>
          <input type="range" id="dt-bgdark" min="0" max="1" step="0.02" value="0"></div>
        </div>
      </div>

      <!-- â˜… NEON GRID CONTROLS (NEW!) -->
      <div class="controls-section" id="controls-3">
        <div class="section-title">Presets</div>
        <div class="presets-grid" id="presets-3"></div>
        
        <div class="section-title">Grid</div>
        <div class="control-group">
          <div class="control-label"><span>Speed</span><span class="control-value" id="val-ng-speed">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ng-speed"></div>
          <input type="range" id="ng-speed" min="0.1" max="3" step="0.05" value="1"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Grid Size</span><span class="control-value" id="val-ng-gridsize">0.10</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ng-gridsize"></div>
          <input type="range" id="ng-gridsize" min="0.03" max="0.3" step="0.005" value="0.1"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Line Thickness</span><span class="control-value" id="val-ng-linethick">0.02</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ng-linethick"></div>
          <input type="range" id="ng-linethick" min="0.003" max="0.05" step="0.001" value="0.02"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Glow</span><span class="control-value" id="val-ng-glow">1.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ng-glow"></div>
          <input type="range" id="ng-glow" min="0.5" max="4" step="0.1" value="1.5"></div>
        </div>
        
        <div class="section-title">Animation</div>
        <div class="control-group">
          <div class="control-label"><span>Pulse</span><span class="control-value" id="val-ng-pulse">2.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ng-pulse"></div>
          <input type="range" id="ng-pulse" min="0" max="6" step="0.1" value="2"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Depth</span><span class="control-value" id="val-ng-depth">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ng-depth"></div>
          <input type="range" id="ng-depth" min="0.3" max="4" step="0.1" value="1"></div>
        </div>
        
        <div class="section-title">Color</div>
        <div class="control-group">
          <div class="control-label"><span>Hue</span><span class="control-value" id="val-ng-hue">0.85</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ng-hue"></div>
          <input type="range" id="ng-hue" min="0" max="1" step="0.01" value="0.85"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Saturation</span><span class="control-value" id="val-ng-saturation">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ng-saturation"></div>
          <input type="range" id="ng-saturation" min="0.2" max="2" step="0.05" value="1"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>BG Darkness</span><span class="control-value" id="val-ng-bgdark">0.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ng-bgdark"></div>
          <input type="range" id="ng-bgdark" min="0" max="1" step="0.02" value="0"></div>
        </div>
        
        <div class="section-title">Effects</div>
        <div class="control-group">
          <div class="control-label"><span>Scanlines</span><span class="control-value" id="val-ng-scanlines">0.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ng-scanlines"></div>
          <input type="range" id="ng-scanlines" min="0" max="1" step="0.05" value="0.5"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Chromatic</span><span class="control-value" id="val-ng-chromatic">0.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ng-chromatic"></div>
          <input type="range" id="ng-chromatic" min="0" max="2" step="0.05" value="0.5"></div>
        </div>
      </div>

      <!-- â˜… ELECTRIC ARCS CONTROLS (NEW!) -->
      <div class="controls-section" id="controls-4">
        <div class="section-title">Presets</div>
        <div class="presets-grid" id="presets-4"></div>
        
        <div class="section-title">Arcs</div>
        <div class="control-group">
          <div class="control-label"><span>Num Arcs</span><span class="control-value" id="val-ea-arcs">5</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ea-arcs"></div>
          <input type="range" id="ea-arcs" min="1" max="8" step="1" value="5"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Speed</span><span class="control-value" id="val-ea-speed">2.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ea-speed"></div>
          <input type="range" id="ea-speed" min="0.2" max="5" step="0.1" value="2"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Thickness</span><span class="control-value" id="val-ea-thickness">0.02</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ea-thickness"></div>
          <input type="range" id="ea-thickness" min="0.005" max="0.05" step="0.001" value="0.02"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Glow</span><span class="control-value" id="val-ea-glow">1.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ea-glow"></div>
          <input type="range" id="ea-glow" min="0.5" max="4" step="0.1" value="1.5"></div>
        </div>
        
        <div class="section-title">Detail</div>
        <div class="control-group">
          <div class="control-label"><span>Branching</span><span class="control-value" id="val-ea-branch">0.80</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ea-branch"></div>
          <input type="range" id="ea-branch" min="0" max="1.5" step="0.05" value="0.8"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Jitter</span><span class="control-value" id="val-ea-jitter">0.30</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ea-jitter"></div>
          <input type="range" id="ea-jitter" min="0.05" max="0.6" step="0.01" value="0.3"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Spread</span><span class="control-value" id="val-ea-spread">0.30</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ea-spread"></div>
          <input type="range" id="ea-spread" min="0.1" max="0.6" step="0.02" value="0.3"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Pulse</span><span class="control-value" id="val-ea-pulse">3.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ea-pulse"></div>
          <input type="range" id="ea-pulse" min="0" max="10" step="0.2" value="3"></div>
        </div>
        
        <div class="section-title">Color</div>
        <div class="control-group">
          <div class="control-label"><span>Hue</span><span class="control-value" id="val-ea-hue">0.60</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ea-hue"></div>
          <input type="range" id="ea-hue" min="0" max="1" step="0.01" value="0.6"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Saturation</span><span class="control-value" id="val-ea-saturation">0.80</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ea-saturation"></div>
          <input type="range" id="ea-saturation" min="0.2" max="2" step="0.05" value="0.8"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>BG Darkness</span><span class="control-value" id="val-ea-bgdark">0.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ea-bgdark"></div>
          <input type="range" id="ea-bgdark" min="0" max="1" step="0.02" value="0"></div>
        </div>
      </div>

      <!-- NEON SPOKES CONTROLS -->
      <div class="controls-section" id="controls-5">
        <div class="section-title">Presets</div>
        <div class="presets-grid" id="presets-5"></div>
        
        <div class="section-title">Motion</div>
        <div class="control-group">
          <div class="control-label"><span>Speed</span><span class="control-value" id="val-ns-speed">3.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ns-speed"></div>
          <input type="range" id="ns-speed" min="0" max="8" step="0.1" value="3"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Zoom</span><span class="control-value" id="val-ns-zoom">1.10</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ns-zoom"></div>
          <input type="range" id="ns-zoom" min="0.5" max="3" step="0.05" value="1.1"></div>
        </div>
        
        <div class="section-title">Structure</div>
        <div class="control-group">
          <div class="control-label"><span>Iterations</span><span class="control-value" id="val-ns-iterations">40</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ns-iterations"></div>
          <input type="range" id="ns-iterations" min="10" max="80" step="1" value="40"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Complexity</span><span class="control-value" id="val-ns-complexity">0.20</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ns-complexity"></div>
          <input type="range" id="ns-complexity" min="0.05" max="0.5" step="0.01" value="0.2"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Step Size</span><span class="control-value" id="val-ns-stepsize">0.60</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ns-stepsize"></div>
          <input type="range" id="ns-stepsize" min="0.2" max="1.2" step="0.02" value="0.6"></div>
        </div>
        
        <div class="section-title">Color</div>
        <div class="control-group">
          <div class="control-label"><span>Saturation</span><span class="control-value" id="val-ns-saturation">0.60</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ns-saturation"></div>
          <input type="range" id="ns-saturation" min="0" max="2" step="0.02" value="0.6"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Exposure</span><span class="control-value" id="val-ns-exposure">1000</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-ns-exposure"></div>
          <input type="range" id="ns-exposure" min="100" max="3000" step="50" value="1000"></div>
        </div>
      </div>

      <!-- CRYSTAL LATTICE CONTROLS -->
      <div class="controls-section" id="controls-6">
        <div class="section-title">Presets</div>
        <div class="presets-grid" id="presets-6"></div>
        
        <div class="section-title">Camera &amp; Motion</div>
        <div class="control-group">
          <div class="control-label"><span>Speed</span><span class="control-value" id="val-cl-speed">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cl-speed"></div>
          <input type="range" id="cl-speed" min="0" max="4" step="0.05" value="1"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Path Curve</span><span class="control-value" id="val-cl-pathcurve">0.20</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cl-pathcurve"></div>
          <input type="range" id="cl-pathcurve" min="0" max="1" step="0.01" value="0.2"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Step Scale</span><span class="control-value" id="val-cl-stepscale">0.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cl-stepscale"></div>
          <input type="range" id="cl-stepscale" min="0.1" max="1.5" step="0.02" value="0.5"></div>
        </div>
        
        <div class="section-title">Swirl</div>
        <div class="control-group">
          <div class="control-label"><span>Swirl Intensity</span><span class="control-value" id="val-cl-swirl">0.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cl-swirl"></div>
          <input type="range" id="cl-swirl" min="0" max="2" step="0.02" value="0.5"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Swirl Frequency</span><span class="control-value" id="val-cl-swirlfreq">0.20</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cl-swirlfreq"></div>
          <input type="range" id="cl-swirlfreq" min="0.05" max="1" step="0.01" value="0.2"></div>
        </div>
        
        <div class="section-title">Geometry</div>
        <div class="control-group">
          <div class="control-label"><span>Shape Size</span><span class="control-value" id="val-cl-shapesize">0.30</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cl-shapesize"></div>
          <input type="range" id="cl-shapesize" min="0.05" max="0.6" step="0.01" value="0.3"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Shape Mod</span><span class="control-value" id="val-cl-shapemod">0.65</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cl-shapemod"></div>
          <input type="range" id="cl-shapemod" min="0" max="2" step="0.02" value="0.65"></div>
        </div>
        
        <div class="section-title">Color</div>
        <div class="control-group">
          <div class="control-label"><span>Glow</span><span class="control-value" id="val-cl-glow">0.90</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cl-glow"></div>
          <input type="range" id="cl-glow" min="0.1" max="2" step="0.02" value="0.9"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Color R</span><span class="control-value" id="val-cl-colorr">0.30</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cl-colorr"></div>
          <input type="range" id="cl-colorr" min="0" max="6.28" step="0.05" value="0.3"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Color G</span><span class="control-value" id="val-cl-colorg">1.30</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cl-colorg"></div>
          <input type="range" id="cl-colorg" min="0" max="6.28" step="0.05" value="1.3"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Color B</span><span class="control-value" id="val-cl-colorb">1.83</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cl-colorb"></div>
          <input type="range" id="cl-colorb" min="0" max="6.28" step="0.05" value="1.83"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Exposure</span><span class="control-value" id="val-cl-exposure">40000</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-cl-exposure"></div>
          <input type="range" id="cl-exposure" min="5000" max="100000" step="1000" value="40000"></div>
        </div>
      </div>

      <!-- RAINBOW NEBULA CONTROLS -->
      <div class="controls-section" id="controls-7">
        <div class="section-title">Presets</div>
        <div class="presets-grid" id="presets-7"></div>
        
        <div class="section-title">Motion</div>
        <div class="control-group">
          <div class="control-label"><span>Speed</span><span class="control-value" id="val-rn-speed">4.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-rn-speed"></div>
          <input type="range" id="rn-speed" min="0" max="10" step="0.1" value="4"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Turbulence</span><span class="control-value" id="val-rn-turbulence">0.80</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-rn-turbulence"></div>
          <input type="range" id="rn-turbulence" min="0" max="2" step="0.02" value="0.8"></div>
        </div>
        
        <div class="section-title">Structure</div>
        <div class="control-group">
          <div class="control-label"><span>Iterations</span><span class="control-value" id="val-rn-iterations">2.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-rn-iterations"></div>
          <input type="range" id="rn-iterations" min="0.5" max="4" step="0.1" value="2"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Scale</span><span class="control-value" id="val-rn-scale">5.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-rn-scale"></div>
          <input type="range" id="rn-scale" min="1" max="15" step="0.2" value="5"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Detail</span><span class="control-value" id="val-rn-detail">0.08</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-rn-detail"></div>
          <input type="range" id="rn-detail" min="0.01" max="0.2" step="0.005" value="0.08"></div>
        </div>
        
        <div class="section-title">Color</div>
        <div class="control-group">
          <div class="control-label"><span>Saturation</span><span class="control-value" id="val-rn-saturation">1.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-rn-saturation"></div>
          <input type="range" id="rn-saturation" min="0" max="3" step="0.05" value="1.5"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Brightness</span><span class="control-value" id="val-rn-brightness">0.05</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-rn-brightness"></div>
          <input type="range" id="rn-brightness" min="0.01" max="0.15" step="0.005" value="0.05"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Hue Shift</span><span class="control-value" id="val-rn-hue">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-rn-hue"></div>
          <input type="range" id="rn-hue" min="0" max="6.28" step="0.05" value="1"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Exposure</span><span class="control-value" id="val-rn-exposure">1000</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-rn-exposure"></div>
          <input type="range" id="rn-exposure" min="100" max="5000" step="50" value="1000"></div>
        </div>
      </div>

      <!-- INFERNO FIRE CONTROLS -->
      <div class="controls-section" id="controls-8">
        <div class="section-title">Presets</div>
        <div class="presets-grid" id="presets-8"></div>
        
        <div class="section-title">Flame</div>
        <div class="control-group">
          <div class="control-label"><span>Height</span><span class="control-value" id="val-fire-height">1.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-fire-height"></div>
          <input type="range" id="fire-height" min="0.3" max="2" step="0.05" value="1"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Width</span><span class="control-value" id="val-fire-width">1.20</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-fire-width"></div>
          <input type="range" id="fire-width" min="0.3" max="3" step="0.05" value="1.2"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Intensity</span><span class="control-value" id="val-fire-intensity">2.00</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-fire-intensity"></div>
          <input type="range" id="fire-intensity" min="0.5" max="5" step="0.1" value="2"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Time Scale</span><span class="control-value" id="val-fire-timescale">0.50</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-fire-timescale"></div>
          <input type="range" id="fire-timescale" min="0.1" max="2" step="0.05" value="0.5"></div>
        </div>
        
        <div class="section-title">Effects</div>
        <div class="control-group">
          <div class="control-label"><span>Spark Count</span><span class="control-value" id="val-fire-sparks">100</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-fire-sparks"></div>
          <input type="range" id="fire-sparks" min="20" max="200" step="5" value="100"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Smoke Opacity</span><span class="control-value" id="val-fire-smoke">0.80</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-fire-smoke"></div>
          <input type="range" id="fire-smoke" min="0" max="1.5" step="0.05" value="0.8"></div>
        </div>
        <div class="control-group">
          <div class="control-label"><span>Noise Detail</span><span class="control-value" id="val-fire-noise">5</span></div>
          <div class="slider-track"><div class="slider-fill" id="fill-fire-noise"></div>
          <input type="range" id="fire-noise" min="1" max="8" step="1" value="5"></div>
        </div>
      </div>

      <div class="tip-box">
        <strong>â˜… NEW:</strong> Cosmic Mandala &amp; Plasma Vortex! Press SPACE to pause. Mouse drag for orbit control on Neon Spokes.
      </div>
    </div>
  </div>
</div>

<!-- Export Modal -->
<div class="modal-overlay" id="export-modal">
  <div class="modal-content">
    <div class="modal-header">
      <span class="modal-title">SHADERTOY EXPORT</span>
      <button class="modal-close" id="modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <pre class="code-preview" id="code-preview"></pre>
    </div>
    <div class="modal-footer">
      <button class="modal-btn secondary" id="modal-cancel">Cancel</button>
      <button class="modal-btn primary" id="modal-copy">Copy to Clipboard</button>
    </div>
  </div>
</div>

<!-- Audio Player -->
<audio id="bgm" loop preload="auto">
  <source src="1.mp3" type="audio/mpeg">
</audio>

<script>
// ============== SHADER SOURCES ==============

// â˜… NEW: Cosmic Mandala - Sacred geometry kaleidoscope
const cosmicMandalaShader = `
precision highp float;
uniform vec2 iResolution;
uniform float iTime;
uniform float u_symmetry, u_layers, u_complexity, u_ringscale;
uniform float u_rotspeed, u_pulsespeed, u_pulseamt, u_spiral;
uniform float u_glow, u_falloff, u_colorcycle, u_hue, u_saturation;
uniform float u_edgeglow, u_bloom, u_zoom;

#define PI 3.14159265359

vec3 hsv2rgb(vec3 c) {
  vec4 K = vec4(1.0, 2.0/3.0, 1.0/3.0, 3.0);
  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

float mandalaShape(vec2 p, float t, float layer) {
  float angle = atan(p.y, p.x);
  float radius = length(p);
  
  // Apply spiral twist
  angle += u_spiral * radius;
  
  // Symmetry folding
  float sym = u_symmetry;
  angle = mod(angle, 2.0 * PI / sym);
  angle = abs(angle - PI / sym);
  
  // Reconstruct position
  vec2 q = vec2(cos(angle), sin(angle)) * radius;
  
  // Layer-based pattern
  float pattern = 0.0;
  float scale = u_ringscale * (1.0 + layer * 0.5);
  
  // Rings
  float ring = abs(sin(radius * scale * 5.0 - t * u_pulsespeed));
  ring = pow(ring, u_complexity);
  
  // Petals
  float petals = abs(sin(angle * sym * 2.0 + t * 0.5));
  petals *= smoothstep(0.0, 0.5, radius);
  
  // Combine
  pattern = ring * 0.5 + petals * 0.5;
  pattern *= (1.0 + u_pulseamt * sin(t * u_pulsespeed * 2.0 + radius * 3.0));
  
  return pattern;
}

void mainImage(out vec4 O, vec2 fragCoord) {
  vec2 uv = (fragCoord - iResolution.xy * 0.5) / iResolution.y;
  uv /= u_zoom;
  
  float t = iTime * u_rotspeed;
  
  // Rotate entire mandala
  float c = cos(t * 0.3), s = sin(t * 0.3);
  uv = mat2(c, -s, s, c) * uv;
  
  vec3 col = vec3(0.0);
  float radius = length(uv);
  float angle = atan(uv.y, uv.x);
  
  // Multiple layers
  for (float i = 0.0; i < 10.0; i++) {
    if (i >= u_layers) break;
    
    float layerOffset = i * 0.2;
    vec2 p = uv * (1.0 + i * 0.15);
    
    // Rotate each layer differently
    float lt = t * (1.0 + i * 0.1);
    float lc = cos(lt * 0.2), ls = sin(lt * 0.2);
    p = mat2(lc, -ls, ls, lc) * p;
    
    float pattern = mandalaShape(p, iTime, i);
    
    // Color based on layer and position
    float hue = u_hue + i * 0.1 + radius * 0.2 + iTime * u_colorcycle * 0.1;
    vec3 layerCol = hsv2rgb(vec3(hue, u_saturation, 1.0));
    
    // Glow effect
    float glow = pattern * u_glow / (1.0 + pow(radius * u_falloff, 2.0));
    col += layerCol * glow * (1.0 - i / u_layers * 0.5);
  }
  
  // Edge glow
  float edgeDist = abs(sin(radius * 10.0 - iTime));
  col += vec3(0.5, 0.8, 1.0) * u_edgeglow * exp(-edgeDist * 5.0) / (1.0 + radius * 2.0);
  
  // Center glow
  col += vec3(1.0, 0.9, 0.8) * 0.3 / (1.0 + radius * radius * 20.0);
  
  // Bloom
  col += col * col * u_bloom;
  
  // Tone mapping
  col = col / (col + 1.0);
  col = pow(col, vec3(0.9));
  
  O = vec4(col, 1.0);
}

void main() { vec4 O; mainImage(O, gl_FragCoord.xy); gl_FragColor = O; }
`;

// â˜… NEW: Plasma Vortex - Electric energy swirls
const plasmaVortexShader = `
precision highp float;
uniform vec2 iResolution;
uniform float iTime;
uniform float u_arms, u_spin, u_tightness, u_coresize;
uniform float u_plasma, u_tendrils, u_noisescale, u_turbulence;
uniform float u_pulserate, u_waves, u_wavespeed;
uniform float u_colormode, u_hue, u_coreglow, u_bloom, u_zoom;

#define PI 3.14159265359

// Simplex-like noise
float hash(vec2 p) {
  return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
}

float noise(vec2 p) {
  vec2 i = floor(p);
  vec2 f = fract(p);
  f = f * f * (3.0 - 2.0 * f);
  return mix(
    mix(hash(i), hash(i + vec2(1.0, 0.0)), f.x),
    mix(hash(i + vec2(0.0, 1.0)), hash(i + vec2(1.0, 1.0)), f.x),
    f.y
  );
}

float fbm(vec2 p) {
  float f = 0.0;
  float amp = 0.5;
  for (int i = 0; i < 5; i++) {
    f += amp * noise(p);
    p *= 2.0;
    amp *= 0.5;
  }
  return f;
}

vec3 hsv2rgb(vec3 c) {
  vec4 K = vec4(1.0, 2.0/3.0, 1.0/3.0, 3.0);
  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

void mainImage(out vec4 O, vec2 fragCoord) {
  vec2 uv = (fragCoord - iResolution.xy * 0.5) / iResolution.y;
  uv /= u_zoom;
  
  float t = iTime;
  float radius = length(uv);
  float angle = atan(uv.y, uv.x);
  
  // Spinning vortex
  float spin = t * u_spin;
  angle += spin;
  angle += u_tightness * radius; // Spiral
  
  // Vortex arms
  float arms = sin(angle * u_arms + radius * u_tightness * 2.0 - t * u_spin * 3.0);
  arms = pow(abs(arms), 0.5) * sign(arms);
  
  // Plasma noise
  vec2 noiseCoord = uv * u_noisescale;
  noiseCoord += vec2(cos(t * 0.3), sin(t * 0.4)) * u_turbulence;
  float plasmaNoise = fbm(noiseCoord + t * 0.2);
  plasmaNoise += fbm(noiseCoord * 2.0 - t * 0.3) * 0.5;
  
  // Electric tendrils
  float tendrils = 0.0;
  for (float i = 0.0; i < 6.0; i++) {
    float a = angle + i * PI / 3.0 + t * 0.5;
    float tendril = sin(a * 3.0 + radius * 8.0 - t * 2.0);
    tendril *= exp(-radius * 2.0);
    tendrils += abs(tendril);
  }
  tendrils *= u_tendrils;
  
  // Energy waves
  float waves = sin(radius * u_waves * 10.0 - t * u_wavespeed * 3.0);
  waves *= exp(-radius * 1.5);
  waves = abs(waves);
  
  // Pulse
  float pulse = 1.0 + 0.3 * sin(t * u_pulserate);
  
  // Combine effects
  float energy = 0.0;
  energy += arms * u_plasma * (1.0 - radius * 0.5);
  energy += plasmaNoise * 0.5;
  energy += tendrils;
  energy += waves * 0.5;
  energy *= pulse;
  
  // Core glow
  float core = u_coreglow / (1.0 + pow(radius / u_coresize, 2.0) * 10.0);
  energy += core;
  
  // Coloring
  vec3 col;
  float hueShift = u_hue + radius * 0.5 + energy * 0.2;
  
  if (u_colormode < 1.0) {
    // Electric blue/purple
    col = hsv2rgb(vec3(0.6 + hueShift * 0.1, 0.8, energy));
    col += vec3(0.3, 0.5, 1.0) * core;
  } else if (u_colormode < 2.0) {
    // Fire/plasma
    col = hsv2rgb(vec3(0.05 + hueShift * 0.05 - energy * 0.1, 0.9, energy));
    col += vec3(1.0, 0.6, 0.2) * core;
  } else {
    // Rainbow cycle
    col = hsv2rgb(vec3(hueShift + t * 0.1, 0.85, energy));
    col += vec3(1.0, 1.0, 1.0) * core * 0.5;
  }
  
  // Bloom
  col += col * col * u_bloom;
  
  // Tone mapping
  col = col / (col + 0.8);
  col = pow(col, vec3(0.95));
  
  O = vec4(col, 1.0);
}

void main() { vec4 O; mainImage(O, gl_FragCoord.xy); gl_FragColor = O; }
`;

// Neon Spokes
const neonSpokesShader = `
precision highp float;
uniform vec2 iResolution;
uniform float iTime;
uniform vec4 iMouse;
uniform float u_speed, u_zoom, u_iterations, u_complexity, u_stepsize;
uniform float u_saturation, u_exposure;

void mainImage(out vec4 O, vec2 u) {
  vec2 p = iResolution.xy;
  vec2 uv = (u - p * .5) / p.y * u_zoom;
  
  vec3 rd = normalize(vec3(uv, 1.));
  float rotY = (iMouse.x / iResolution.x - .5) * 3.1416;
  mat2 rotYmat = mat2(cos(rotY), -sin(rotY), sin(rotY), cos(rotY));
  rd.xz = rotYmat * rd.xz;
  
  float z = 0.;
  O = vec4(0.);
  
  for(float i = 0.; i < 80.; i++) {
    if (i > u_iterations) break;
    vec3 pos = z * rd;
    vec3 v;
    pos.z += u_speed * iTime;
    float d = u_stepsize * length(max(v = cos(pos) - sin(pos).yzx, v.yzx * u_complexity));
    z += d;
    O.rgb += (cos(u_saturation * pos) + 1.) / d;
  }
  O /= O + u_exposure;
  O.a = 1.;
}
void main() { vec4 O; mainImage(O, gl_FragCoord.xy); gl_FragColor = O; }
`;

// Crystal Lattice
const crystalLatticeShader = `
precision highp float;
uniform vec2 iResolution;
uniform float iTime;
uniform vec4 iMouse;
uniform float u_speed, u_pathCurve, u_stepScale;
uniform float u_swirl, u_swirlFreq;
uniform float u_shapeSize, u_shapeMod;
uniform float u_glow, u_colorR, u_colorG, u_colorB;
uniform float u_exposure;

vec3 P(float z) { return vec3(cos(u_pathCurve*z), sin(u_pathCurve*z+.5)*.005, z); }
vec4 tanh4(vec4 x) { vec4 e=exp(2.*clamp(x,-10.,10.)); return (e-1.)/(e+1.); }

void mainImage(out vec4 O, vec2 C) {
  O = vec4(0.);
  vec3 p, X, ro, r = iResolution.xyx;
  float z = 0., t = iTime * u_speed, d = 0.1;
  
  for (float i = 0.; i < 60.; i++) {
    z += u_stepScale * d;
    ro = P(t);
    p = ro + z * normalize(vec3(C - .5*r.xy, r.y));
    p.z += t;
    
    float sa = sin(p.z*u_swirlFreq + t*.25) * u_swirl;
    float cs = cos(sa), ss = sin(sa);
    p.xy = mat2(cs,-ss,ss,cs) * p.xy;
    
    X = p;
    
    float xa = sin(t*.055)*.0011;
    float cx = cos(xa), sx = sin(xa);
    p.xz = mat2(cx,-sx,sx,cx) * p.xz;
    
    p = fract(p) - .5;
    
    float shape = (abs(p.x)+abs(p.y)+abs(p.z));
    float modulation = u_shapeSize * sin(X.z*.2+t*.55) * (X.y*u_shapeMod);
    d = max(shape - abs(modulation), 0.002);
    
    vec4 col = vec4(u_colorR, u_colorG, u_colorB, 0.);
    O += u_glow * (0.6 + 0.4*sin(length(X.xy)*0.5 + X.z*0.02 + col)) / (d * d * 50. + d);
  }
  
  O = tanh4(O/u_exposure);
  O = pow(O, vec4(1./2.2));
  O.a = 1.;
}
void main() { vec4 O; mainImage(O, gl_FragCoord.xy); gl_FragColor = O; }
`;

// Rainbow Nebula
const rainbowNebulaShader = `
precision highp float;
uniform vec2 iResolution;
uniform float iTime;
uniform vec4 iMouse;
uniform float u_speed, u_turbulence, u_iterations, u_scale;
uniform float u_detail, u_saturation, u_brightness, u_hue, u_exposure;

vec4 tanh4(vec4 x) { vec4 e=exp(2.*clamp(x,-10.,10.)); return (e-1.)/(e+1.); }

void mainImage(out vec4 O, vec2 fragCoord) {
  vec2 R = iResolution.xy;
  vec2 uv = (fragCoord - R * .5) / R.y;
  float t = iTime * u_speed * .25;
  float d = 0.01;
  vec4 o = vec4(0.);
  
  for (float i = 0.; i < 80.; i++) {
    vec3 p = vec3(uv * d, d + t * 4.);
    p -= sin(p.z + t + p.xyz * .5) * u_turbulence;
    float s = u_scale - length(p.xy);
    
    float n = 0.06;
    for (int j = 0; j < 5; j++) {
      if (n >= u_iterations) break;
      p.yx *= mat2(cos(t*.1), -sin(t*.1), sin(t*.1), cos(t*.1));
      s -= abs(dot(sin(p.z + t + p * n * 20.), vec3(.33)));
      n *= 2.;
    }
    
    s = .01 + abs(s) * u_detail;
    d += s;
    
    float len = max(length(uv), 0.01);
    o += d * u_brightness / len / s;
    
    vec4 c = cos(vec4(
      u_hue - t + 1.,
      u_hue * 2. - t * .8 + 5.,
      d * u_saturation + t * 1.4 + 2.,
      d + t * 3. + 4.
    )) + 1.;
    
    o += d * .05 * vec4(4.,1.,1.,0.) / len;
    o.yz += c.xy * vec2(c.z, c.w + .5) * 1.5;
  }
  
  O = tanh4(o / d / u_exposure);
  O.a = 1.;
}
void main() { vec4 O; mainImage(O, gl_FragCoord.xy); gl_FragColor = O; }
`;

// Inferno Fire
const infernoFireShader = `
precision highp float;
uniform vec2 iResolution;
uniform float iTime;
uniform float u_flameHeight, u_flameWidth, u_flameIntensity, u_timeScale;
uniform float u_sparkCount, u_smokeOpacity, u_noiseOctaves;

vec3 fmod289(vec3 x){return x-floor(x*(1./289.))*289.;}
vec4 fmod289(vec4 x){return x-floor(x*(1./289.))*289.;}
vec4 permute(vec4 x){return fmod289(((x*34.)+1.)*x);}

float snoise(vec3 v){
  const vec2 C = vec2(1./6.,1./3.); const vec4 D = vec4(0.,.5,1.,2.);
  vec3 i = floor(v + dot(v, C.yyy)); vec3 x0 = v - i + dot(i, C.xxx);
  vec3 g = step(x0.yzx, x0.xyz); vec3 l = 1. - g;
  vec3 i1 = min(g.xyz, l.zxy); vec3 i2 = max(g.xyz, l.zxy);
  vec3 x1 = x0 - i1 + C.xxx; vec3 x2 = x0 - i2 + C.yyy;
  vec3 x3 = x0 - D.yyy; i = fmod289(i);
  vec4 p = permute(permute(permute(i.z + vec4(0., i1.z, i2.z, 1.))
      + i.y + vec4(0., i1.y, i2.y, 1.))+ i.x + vec4(0., i1.x, i2.x, 1.));
  float n_ = .142857142857; vec3 ns = n_ * D.wyz - D.xzx;
  vec4 j = p - 49. * floor(p * ns.z * ns.z);
  vec4 x_ = floor(j * ns.z); vec4 y_ = floor(j - 7. * x_);
  vec4 x = x_ * ns.x + ns.yyyy; vec4 y = y_ * ns.x + ns.yyyy;
  vec4 h = 1. - abs(x) - abs(y);
  vec4 b0 = vec4(x.xy, y.xy); vec4 b1 = vec4(x.zw, y.zw);
  vec4 s0 = floor(b0) * 2. + 1.;vec4 s1 = floor(b1) * 2. + 1.;
  vec4 sh = -step(h, vec4(0.));
  vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy; vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;
  vec3 p0 = vec3(a0.xy, h.x); vec3 p1 = vec3(a0.zw, h.y);
  vec3 p2 = vec3(a1.xy, h.z); vec3 p3 = vec3(a1.zw, h.w);
  vec4 norm = 1./sqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));
  p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;
  vec4 m = max(.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.); m=m*m;
  return 42.*dot(m*m, vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));
}

float prng(vec2 seed) {
  seed = fract(seed * vec2(5.3983, 5.4427));
  seed += dot(seed.yx, seed.xy + vec2(21.5351, 14.3137));
  return fract(seed.x * seed.y * 95.4337);
}

float noiseStack(vec3 pos, float octaves, float falloff) {
  float noise = snoise(pos); float off = 1.;
  if (octaves > 1.) {pos *= 2.;off *= falloff; noise = (1.-off)*noise + off*snoise(pos);}
  if (octaves > 2.) {pos *= 2.;off *= falloff; noise = (1.-off)*noise + off*snoise(pos);}
  if (octaves > 3.) {pos *= 2.;off *= falloff; noise = (1.-off)*noise + off*snoise(pos);}
  if (octaves > 4.) {pos *= 2.;off *= falloff; noise = (1.-off)*noise + off*snoise(pos);}
  return (1.+noise)/2.;
}

vec2 noiseStackUV(vec3 pos, float octaves, float falloff) {
  float dA = noiseStack(pos, octaves, falloff);
  float dB = noiseStack(pos + vec3(3984.293, 423.21, 5235.19), octaves, falloff);
  return vec2(dA, dB);
}

void mainImage(out vec4 fragColor, vec2 fragCoord) {
  vec2 uv = fragCoord.xy/iResolution.xy;
  float PI = 3.14159265;
  float ypartClip = uv.y * u_flameHeight;
  float ypartClippedFalloff = clamp(u_flameHeight - ypartClip, 0., 1.);
  float ypartClipped = min(ypartClip, 1.);
  float ypartClippedn = 1.-ypartClipped;
  float xfuel = u_flameWidth * (1.-abs(2.*uv.x-1.));
  float realTime = u_timeScale * iTime;
  vec2 coordScaled = 6.*uv-.2;
  vec3 position = vec3(coordScaled,0.)+vec3(1223.,6434.,8425.);
  vec3 flow = vec3(4.1*(.5-uv.x)*pow(ypartClippedn,4.),-2.*xfuel*pow(ypartClippedn,64.),0.);
  vec3 timing = realTime * vec3(0., -1.7, 1.1) + flow;
  vec3 displacePos = vec3(1.,.5,1.)*2.4*position+realTime*vec3(.01,-.7,1.3);
  vec3 displace3 = vec3(noiseStackUV(displacePos, 2., .4), 0.);
  vec3 noiseCoord = vec3(2.,1.,1.)*position+timing+.4*displace3;
  float noise = noiseStack(noiseCoord, u_noiseOctaves, .4);
  float flames = pow(ypartClipped,.3*xfuel)*pow(noise,.3*xfuel);
  float f = ypartClippedFalloff*pow(1.-flames*flames*flames,8.);
  float fire = u_flameIntensity*(pow(f,3.)+f);
  float smokeNoise = .5+snoise(.4*(position+vec3(0.,1.,0.))+timing*vec3(1.,.8,-.5))/2.;
  float smoke = u_smokeOpacity*pow(xfuel,3.)*pow(uv.y,2.)*(smokeNoise+.4*(1.-noise));
  float sparkGridSize = u_sparkCount;
  vec2 sparkCoord = uv*300.-vec2(.0,190.*realTime);
  sparkCoord -= 30.*noiseStackUV(.01*vec3(sparkCoord,30.*iTime),1.,.4);
  sparkCoord += 100.*flow.xy;
  if (mod(sparkCoord.y/sparkGridSize,2.)<1.) sparkCoord.x +=.5*sparkGridSize;
  vec2 sparkGridIndex = floor(sparkCoord/sparkGridSize);
  float sparkRandom = prng(sparkGridIndex);
  float sparkLife=min(10.*(1.-min((sparkGridIndex.y+(190.*realTime/sparkGridSize))/(24.-20.*sparkRandom),1.)),1.);
  float sparks = 0.;
  if (sparkLife > 0.) {
    float sparkSize = xfuel*xfuel*sparkRandom*.04;
    float sparkRadians = 999.*sparkRandom*2.*PI+2.*iTime;
    vec2 sparkCircular = vec2(sin(sparkRadians), cos(sparkRadians));
    vec2 sparkOffset = (.5-sparkSize)*sparkGridSize*sparkCircular;
    vec2 sparkfmod = mod(sparkCoord+sparkOffset,sparkGridSize)-.5*sparkGridSize;
    float sparksGray = max(0., 1. - length(sparkfmod) / (sparkSize * sparkGridSize));
    sparks = sparkLife * sparksGray;
  }
  float o = max(fire, sparks);
  fragColor = o*vec4(1.,.5,.0,1.)+vec4(.9,.8,.7,1.)*smoke;
  fragColor.a = 1.;
}
void main() { vec4 O; mainImage(O, gl_FragCoord.xy); gl_FragColor = O; }
`;

// â˜… NEW: Dark Transit - Low tech tunnel (by diatribes, golfed by FabriceNeyret2)
const darkTransitShader = `
precision highp float;
uniform vec2 iResolution;
uniform float iTime;
uniform float u_speed, u_radius, u_scoops, u_detail, u_orb;
uniform float u_brightness, u_saturation, u_bgdark;

#define T (iTime * u_speed + 5. + 5.*sin(iTime*.3))
#define P(z) vec3(12.* cos((z)*vec2(.1,.12)), z)

float A(float F, float H, float K, vec3 p) {
  return abs(dot(sin(F*p*K), vec3(H))) / K;
}

void mainImage(out vec4 o, in vec2 u) {
  float t,s,i,d,e;
  vec3 c = vec3(0.0);
  vec2 r = iResolution;
  u = (u - r/2.) / r.y;
  
  vec3 p = P(T),
       Z = normalize(P(T+4.) - p),
       X = normalize(vec3(Z.z, 0, -Z.x)),
       D = vec3(u, 1) * mat3(-X, cross(X, Z), Z);
  
  for(float i = 0.; i < 28.; i++) {
    if (d > 30.) break;
    vec3 X2 = P(p.z);
    t = sin(iTime);
    e = length(p - vec3(X2.x + t, X2.y + t*2., 6.+T + t*2.)) - 0.01;
    e *= u_orb;
    s = cos(p.z*.6)*2.+ u_radius
      - min(length(p.xy - X2.x - 6.), length((p-X2).xy))
      + A(4., u_scoops, .1, p)
      + A(T+8., u_detail, 2., p);
    s = min(e, .01 + .3*abs(s));
    p += D * s;
    d += s;
    c += 1./s + 10.*vec3(1, 2, 5)/max(e + .4, .6);
  }
  
  o.rgb = c * c * u_brightness / 1e6;
  o.rgb = mix(vec3(length(o.rgb) * u_bgdark), o.rgb, u_saturation);
  o.a = 1.;
}
void main() { vec4 O; mainImage(O, gl_FragCoord.xy); gl_FragColor = O; }
`;

// â˜… NEW: Neon Grid - Electric cyberpunk grid with glow
const neonGridShader = `
precision highp float;
uniform vec2 iResolution;
uniform float iTime;
uniform float u_speed, u_gridsize, u_linethick, u_glow;
uniform float u_pulse, u_depth, u_hue, u_saturation;
uniform float u_bgdark, u_scanlines, u_chromatic;

vec3 hsv2rgb(vec3 c) {
  vec4 K = vec4(1.0, 2.0/3.0, 1.0/3.0, 3.0);
  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

void mainImage(out vec4 fragColor, in vec2 fragCoord) {
  vec2 uv = (fragCoord - 0.5 * iResolution.xy) / iResolution.y;
  float t = iTime * u_speed;
  
  // Perspective grid
  vec3 ro = vec3(0, 1.5, t * 2.);
  vec3 rd = normalize(vec3(uv.x, uv.y - 0.3, 1.0));
  
  // Ground plane intersection
  float d = -ro.y / rd.y;
  vec3 p = ro + rd * max(d, 0.0);
  
  // Grid pattern
  vec2 grid = abs(fract(p.xz * u_gridsize) - 0.5);
  float line = min(grid.x, grid.y);
  float thick = u_linethick * (1.0 + 0.5 * sin(t * u_pulse));
  
  // Distance fade
  float fade = exp(-d * 0.03 * u_depth);
  
  // Glow effect
  float glow = thick / (line + 0.001);
  glow = pow(glow, 1.5) * u_glow * fade;
  glow *= smoothstep(0.0, 0.1, d);
  
  // Pulse waves
  float wave = sin(p.z * 0.5 - t * 3.) * 0.5 + 0.5;
  glow *= 0.5 + wave * 0.5;
  
  // Color
  float hue = u_hue + p.z * 0.02 + t * 0.1;
  vec3 col = hsv2rgb(vec3(hue, u_saturation, 1.0)) * glow;
  
  // Horizon glow
  float horizon = exp(-abs(uv.y + 0.1) * 5.) * 0.5;
  col += hsv2rgb(vec3(hue + 0.3, 0.8, horizon));
  
  // Scanlines
  col *= 1.0 - u_scanlines * 0.3 * sin(fragCoord.y * 2.0);
  
  // Chromatic aberration
  if (u_chromatic > 0.0) {
    vec2 offset = uv * u_chromatic * 0.02;
    col.r *= 1.0 + length(offset);
    col.b *= 1.0 - length(offset) * 0.5;
  }
  
  // Background
  vec3 bg = vec3(u_bgdark * 0.02);
  col = max(col, bg);
  
  fragColor = vec4(col, 1.0);
}
void main() { vec4 O; mainImage(O, gl_FragCoord.xy); gl_FragColor = O; }
`;

// â˜… NEW: Electric Arcs - Lightning and plasma arcs
const electricArcsShader = `
precision highp float;
uniform vec2 iResolution;
uniform float iTime;
uniform float u_arcs, u_speed, u_thickness, u_glow;
uniform float u_branch, u_jitter, u_hue, u_saturation;
uniform float u_bgdark, u_pulse, u_spread;

vec3 hsv2rgb(vec3 c) {
  vec4 K = vec4(1.0, 2.0/3.0, 1.0/3.0, 3.0);
  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

float hash(vec2 p) {
  return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
}

float noise(vec2 p) {
  vec2 i = floor(p);
  vec2 f = fract(p);
  f = f * f * (3.0 - 2.0 * f);
  return mix(mix(hash(i), hash(i + vec2(1,0)), f.x),
             mix(hash(i + vec2(0,1)), hash(i + vec2(1,1)), f.x), f.y);
}

float fbm(vec2 p) {
  float v = 0.0, a = 0.5;
  for (int i = 0; i < 5; i++) {
    v += a * noise(p);
    p *= 2.0;
    a *= 0.5;
  }
  return v;
}

float lightning(vec2 uv, float seed, float t) {
  float y = uv.y;
  float x = uv.x;
  
  // Main arc path with noise displacement
  float path = sin(y * 3.0 + seed * 10.0) * 0.3;
  path += fbm(vec2(y * 5.0 + t * u_speed, seed * 100.0)) * u_jitter;
  
  // Branching
  float branch = 0.0;
  for (float i = 0.0; i < 3.0; i++) {
    float by = y - 0.3 - i * 0.2;
    if (by > 0.0) {
      float bp = path + fbm(vec2(by * 8.0 + t, seed * 50.0 + i)) * 0.4;
      bp += (by * by) * sign(hash(vec2(seed, i)) - 0.5) * u_branch;
      float bd = abs(x - bp);
      branch += u_thickness * 0.3 / (bd + 0.01);
    }
  }
  
  // Main bolt
  float dist = abs(x - path);
  float bolt = u_thickness / (dist + 0.005);
  
  // Glow
  bolt = pow(bolt, 1.2) * u_glow;
  
  return bolt + branch * u_branch;
}

void mainImage(out vec4 fragColor, in vec2 fragCoord) {
  vec2 uv = (fragCoord - 0.5 * iResolution.xy) / iResolution.y;
  float t = iTime;
  
  vec3 col = vec3(u_bgdark * 0.02);
  
  // Multiple arcs
  float numArcs = u_arcs;
  for (float i = 0.0; i < 8.0; i++) {
    if (i >= numArcs) break;
    
    float seed = i * 0.1 + floor(t * 0.5 + i * 0.3);
    float offsetX = (i - numArcs * 0.5) * u_spread;
    vec2 arcUV = uv - vec2(offsetX, 0.0);
    
    // Pulse
    float pulse = 0.5 + 0.5 * sin(t * u_pulse + i * 2.0);
    
    float arc = lightning(arcUV, seed, t) * pulse;
    
    // Color variation per arc
    float hue = u_hue + i * 0.05;
    vec3 arcCol = hsv2rgb(vec3(hue, u_saturation, 1.0));
    
    col += arcCol * arc * 0.15;
  }
  
  // Core brightness boost
  col = pow(col, vec3(0.8));
  
  // Clamp and output
  col = clamp(col, 0.0, 1.0);
  
  fragColor = vec4(col, 1.0);
}
void main() { vec4 O; mainImage(O, gl_FragCoord.xy); gl_FragColor = O; }
`;

// ============== PRESETS ==============

const presetsData = {
  0: [ // â˜… Plasma Vortex (FIRST!) - Energy Burst is first preset
    { name:"ENERGY BURST", 'pv-arms':12,'pv-spin':3,'pv-tightness':1,'pv-coresize':0.12,'pv-plasma':3,'pv-tendrils':2,'pv-noisescale':3,'pv-turbulence':1,'pv-pulserate':6,'pv-waves':4,'pv-wavespeed':4,'pv-colormode':2,'pv-hue':4,'pv-coreglow':4,'pv-bloom':0.8,'pv-zoom':1.3 },
    { name:"ELECTRIC STORM", 'pv-arms':4,'pv-spin':1,'pv-tightness':3,'pv-coresize':0.2,'pv-plasma':1.5,'pv-tendrils':0.8,'pv-noisescale':4,'pv-turbulence':0.5,'pv-pulserate':2,'pv-waves':3,'pv-wavespeed':1.5,'pv-colormode':1,'pv-hue':0,'pv-coreglow':2,'pv-bloom':0.4,'pv-zoom':1 },
    { name:"GALAXY SPIRAL", 'pv-arms':6,'pv-spin':0.5,'pv-tightness':5,'pv-coresize':0.3,'pv-plasma':1.2,'pv-tendrils':0.5,'pv-noisescale':6,'pv-turbulence':0.3,'pv-pulserate':1,'pv-waves':5,'pv-wavespeed':0.8,'pv-colormode':2,'pv-hue':1,'pv-coreglow':3,'pv-bloom':0.3,'pv-zoom':0.8 },
    { name:"PLASMA BALL", 'pv-arms':8,'pv-spin':1.5,'pv-tightness':2,'pv-coresize':0.15,'pv-plasma':2,'pv-tendrils':1.5,'pv-noisescale':3,'pv-turbulence':0.8,'pv-pulserate':4,'pv-waves':6,'pv-wavespeed':2,'pv-colormode':0,'pv-hue':0.5,'pv-coreglow':4,'pv-bloom':0.5,'pv-zoom':1.2 },
    { name:"FIRE VORTEX", 'pv-arms':3,'pv-spin':2,'pv-tightness':4,'pv-coresize':0.25,'pv-plasma':1.8,'pv-tendrils':0.6,'pv-noisescale':5,'pv-turbulence':0.7,'pv-pulserate':3,'pv-waves':4,'pv-wavespeed':2.5,'pv-colormode':1,'pv-hue':5.5,'pv-coreglow':2.5,'pv-bloom':0.6,'pv-zoom':1 },
    { name:"VOID MAELSTROM", 'pv-arms':5,'pv-spin':0.3,'pv-tightness':7,'pv-coresize':0.1,'pv-plasma':0.8,'pv-tendrils':1.2,'pv-noisescale':8,'pv-turbulence':0.2,'pv-pulserate':0.5,'pv-waves':2,'pv-wavespeed':0.5,'pv-colormode':0,'pv-hue':3,'pv-coreglow':1,'pv-bloom':0.2,'pv-zoom':1.5 },
    { name:"NEON TYPHOON", 'pv-arms':4,'pv-spin':2.5,'pv-tightness':2.5,'pv-coresize':0.18,'pv-plasma':2.5,'pv-tendrils':1,'pv-noisescale':4,'pv-turbulence':0.6,'pv-pulserate':5,'pv-waves':8,'pv-wavespeed':3,'pv-colormode':2,'pv-hue':0,'pv-coreglow':3.5,'pv-bloom':0.7,'pv-zoom':0.9 },
    { name:"COSMIC DRAIN", 'pv-arms':2,'pv-spin':0.8,'pv-tightness':8,'pv-coresize':0.4,'pv-plasma':1,'pv-tendrils':0.3,'pv-noisescale':2,'pv-turbulence':0.1,'pv-pulserate':1.5,'pv-waves':1,'pv-wavespeed':1,'pv-colormode':1,'pv-hue':2,'pv-coreglow':5,'pv-bloom':0.3,'pv-zoom':0.7 },
    { name:"AURORA SWIRL", 'pv-arms':6,'pv-spin':0.6,'pv-tightness':4,'pv-coresize':0.35,'pv-plasma':1.3,'pv-tendrils':0.4,'pv-noisescale':7,'pv-turbulence':0.4,'pv-pulserate':0.8,'pv-waves':3,'pv-wavespeed':0.6,'pv-colormode':2,'pv-hue':2.5,'pv-coreglow':2,'pv-bloom':0.25,'pv-zoom':1.1 }
  ],
  1: [ // â˜… Cosmic Mandala
    { name:"SACRED GEOMETRY", 'cm-symmetry':6,'cm-layers':5,'cm-complexity':3,'cm-ringscale':1.5,'cm-rotspeed':0.5,'cm-pulsespeed':1,'cm-pulseamt':0.3,'cm-spiral':0,'cm-glow':1.5,'cm-falloff':2,'cm-colorcycle':0.5,'cm-hue':0,'cm-saturation':1,'cm-edgeglow':0.5,'cm-bloom':0.3,'cm-zoom':1 },
    { name:"FLOWER OF LIFE", 'cm-symmetry':6,'cm-layers':7,'cm-complexity':2,'cm-ringscale':2,'cm-rotspeed':0.3,'cm-pulsespeed':0.5,'cm-pulseamt':0.2,'cm-spiral':0,'cm-glow':1.8,'cm-falloff':1.5,'cm-colorcycle':0.3,'cm-hue':0.5,'cm-saturation':0.8,'cm-edgeglow':0.8,'cm-bloom':0.4,'cm-zoom':0.8 },
    { name:"HYPNOTIC SPIRAL", 'cm-symmetry':8,'cm-layers':4,'cm-complexity':4,'cm-ringscale':1,'cm-rotspeed':1,'cm-pulsespeed':2,'cm-pulseamt':0.5,'cm-spiral':1.5,'cm-glow':2,'cm-falloff':2.5,'cm-colorcycle':1,'cm-hue':2,'cm-saturation':1.2,'cm-edgeglow':0.3,'cm-bloom':0.5,'cm-zoom':1.2 },
    { name:"NEON LOTUS", 'cm-symmetry':12,'cm-layers':6,'cm-complexity':2.5,'cm-ringscale':1.8,'cm-rotspeed':0.4,'cm-pulsespeed':1.5,'cm-pulseamt':0.4,'cm-spiral':0.5,'cm-glow':2.5,'cm-falloff':1.8,'cm-colorcycle':0.8,'cm-hue':4.2,'cm-saturation':1.5,'cm-edgeglow':1,'cm-bloom':0.5,'cm-zoom':0.9 },
    { name:"COSMIC EYE", 'cm-symmetry':3,'cm-layers':8,'cm-complexity':5,'cm-ringscale':2.5,'cm-rotspeed':0.2,'cm-pulsespeed':0.8,'cm-pulseamt':0.6,'cm-spiral':-0.5,'cm-glow':1.2,'cm-falloff':3,'cm-colorcycle':0.2,'cm-hue':1,'cm-saturation':0.9,'cm-edgeglow':0.4,'cm-bloom':0.2,'cm-zoom':1.5 },
    { name:"KALEIDOSCOPE", 'cm-symmetry':16,'cm-layers':3,'cm-complexity':6,'cm-ringscale':1.2,'cm-rotspeed':0.8,'cm-pulsespeed':3,'cm-pulseamt':0.7,'cm-spiral':0,'cm-glow':1.8,'cm-falloff':2,'cm-colorcycle':1.5,'cm-hue':0,'cm-saturation':1.3,'cm-edgeglow':0.6,'cm-bloom':0.4,'cm-zoom':1.1 },
    { name:"VOID PORTAL", 'cm-symmetry':5,'cm-layers':9,'cm-complexity':3.5,'cm-ringscale':3,'cm-rotspeed':0.15,'cm-pulsespeed':0.3,'cm-pulseamt':0.15,'cm-spiral':2,'cm-glow':0.8,'cm-falloff':4,'cm-colorcycle':0.1,'cm-hue':3.5,'cm-saturation':0.5,'cm-edgeglow':1.5,'cm-bloom':0.1,'cm-zoom':2 },
    { name:"ELECTRIC BLOOM", 'cm-symmetry':8,'cm-layers':5,'cm-complexity':4.5,'cm-ringscale':1.3,'cm-rotspeed':0.6,'cm-pulsespeed':4,'cm-pulseamt':0.8,'cm-spiral':0.3,'cm-glow':3,'cm-falloff':1.5,'cm-colorcycle':2,'cm-hue':5,'cm-saturation':1.8,'cm-edgeglow':0.2,'cm-bloom':0.6,'cm-zoom':0.7 },
    { name:"MEDITATION", 'cm-symmetry':6,'cm-layers':10,'cm-complexity':1.5,'cm-ringscale':2.2,'cm-rotspeed':0.1,'cm-pulsespeed':0.2,'cm-pulseamt':0.1,'cm-spiral':0,'cm-glow':1,'cm-falloff':2.5,'cm-colorcycle':0.05,'cm-hue':2.5,'cm-saturation':0.6,'cm-edgeglow':0.3,'cm-bloom':0.15,'cm-zoom':0.6 }
  ],
  2: [ // â˜… Dark Transit
    { name:"LOW TECH", 'dt-speed':4,'dt-radius':4,'dt-scoops':0.25,'dt-detail':0.22,'dt-orb':1,'dt-brightness':1,'dt-saturation':1,'dt-bgdark':0 },
    { name:"WARP CORE", 'dt-speed':6,'dt-radius':3,'dt-scoops':0.3,'dt-detail':0.3,'dt-orb':1.5,'dt-brightness':1.2,'dt-saturation':1.2,'dt-bgdark':0 },
    { name:"DEEP TUNNEL", 'dt-speed':2,'dt-radius':5,'dt-scoops':0.15,'dt-detail':0.15,'dt-orb':0.5,'dt-brightness':0.8,'dt-saturation':0.8,'dt-bgdark':0.2 },
    { name:"NEON PIPE", 'dt-speed':5,'dt-radius':3.5,'dt-scoops':0.4,'dt-detail':0.25,'dt-orb':0.8,'dt-brightness':1.5,'dt-saturation':1.5,'dt-bgdark':0 },
    { name:"VOID RUN", 'dt-speed':8,'dt-radius':4.5,'dt-scoops':0.2,'dt-detail':0.1,'dt-orb':0.3,'dt-brightness':0.6,'dt-saturation':0.6,'dt-bgdark':0.5 },
    { name:"CYBER CHASE", 'dt-speed':7,'dt-radius':3,'dt-scoops':0.35,'dt-detail':0.35,'dt-orb':1.2,'dt-brightness':1.3,'dt-saturation':1.4,'dt-bgdark':0 },
    { name:"SLOW DRIFT", 'dt-speed':1.5,'dt-radius':6,'dt-scoops':0.1,'dt-detail':0.08,'dt-orb':0.2,'dt-brightness':0.7,'dt-saturation':0.5,'dt-bgdark':0.3 },
    { name:"ELECTRIC TUBE", 'dt-speed':4.5,'dt-radius':2.5,'dt-scoops':0.5,'dt-detail':0.4,'dt-orb':2,'dt-brightness':1.8,'dt-saturation':1.6,'dt-bgdark':0 },
    { name:"HYPERSPACE", 'dt-speed':10,'dt-radius':4,'dt-scoops':0.2,'dt-detail':0.2,'dt-orb':1,'dt-brightness':1,'dt-saturation':1,'dt-bgdark':0 }
  ],
  3: [ // â˜… Neon Grid
    { name:"RETROWAVE", 'ng-speed':1,'ng-gridsize':0.1,'ng-linethick':0.02,'ng-glow':1.5,'ng-pulse':2,'ng-depth':1,'ng-hue':0.85,'ng-saturation':1,'ng-bgdark':0,'ng-scanlines':0.5,'ng-chromatic':0.5 },
    { name:"CYBER CITY", 'ng-speed':1.5,'ng-gridsize':0.15,'ng-linethick':0.015,'ng-glow':2,'ng-pulse':3,'ng-depth':0.8,'ng-hue':0.55,'ng-saturation':1.2,'ng-bgdark':0,'ng-scanlines':0.8,'ng-chromatic':1 },
    { name:"TRON LEGACY", 'ng-speed':0.8,'ng-gridsize':0.08,'ng-linethick':0.01,'ng-glow':2.5,'ng-pulse':1,'ng-depth':1.2,'ng-hue':0.5,'ng-saturation':0.8,'ng-bgdark':0,'ng-scanlines':0,'ng-chromatic':0 },
    { name:"NEON HIGHWAY", 'ng-speed':2,'ng-gridsize':0.2,'ng-linethick':0.025,'ng-glow':1.8,'ng-pulse':4,'ng-depth':0.6,'ng-hue':0.0,'ng-saturation':1.5,'ng-bgdark':0,'ng-scanlines':0.3,'ng-chromatic':0.8 },
    { name:"VOID PLANE", 'ng-speed':0.5,'ng-gridsize':0.12,'ng-linethick':0.008,'ng-glow':1,'ng-pulse':0.5,'ng-depth':2,'ng-hue':0.7,'ng-saturation':0.5,'ng-bgdark':0.5,'ng-scanlines':0,'ng-chromatic':0 },
    { name:"ELECTRIC DREAM", 'ng-speed':1.2,'ng-gridsize':0.06,'ng-linethick':0.03,'ng-glow':3,'ng-pulse':5,'ng-depth':0.5,'ng-hue':0.15,'ng-saturation':1.8,'ng-bgdark':0,'ng-scanlines':1,'ng-chromatic':1.5 },
    { name:"MATRIX RAIN", 'ng-speed':1.8,'ng-gridsize':0.05,'ng-linethick':0.012,'ng-glow':2,'ng-pulse':2,'ng-depth':1,'ng-hue':0.35,'ng-saturation':1,'ng-bgdark':0,'ng-scanlines':0.6,'ng-chromatic':0.3 },
    { name:"SUNSET GRID", 'ng-speed':0.6,'ng-gridsize':0.18,'ng-linethick':0.02,'ng-glow':1.2,'ng-pulse':1.5,'ng-depth':1.5,'ng-hue':0.08,'ng-saturation':1.3,'ng-bgdark':0.1,'ng-scanlines':0.2,'ng-chromatic':0.6 },
    { name:"DEEP WEB", 'ng-speed':0.3,'ng-gridsize':0.25,'ng-linethick':0.005,'ng-glow':0.8,'ng-pulse':0.8,'ng-depth':3,'ng-hue':0.6,'ng-saturation':0.4,'ng-bgdark':0.8,'ng-scanlines':0,'ng-chromatic':0 }
  ],
  4: [ // â˜… Electric Arcs
    { name:"LIGHTNING STORM", 'ea-arcs':5,'ea-speed':2,'ea-thickness':0.02,'ea-glow':1.5,'ea-branch':0.8,'ea-jitter':0.3,'ea-hue':0.6,'ea-saturation':0.8,'ea-bgdark':0,'ea-pulse':3,'ea-spread':0.3 },
    { name:"PLASMA CHAMBER", 'ea-arcs':8,'ea-speed':3,'ea-thickness':0.015,'ea-glow':2,'ea-branch':0.5,'ea-jitter':0.2,'ea-hue':0.8,'ea-saturation':1,'ea-bgdark':0,'ea-pulse':5,'ea-spread':0.25 },
    { name:"TESLA COIL", 'ea-arcs':3,'ea-speed':4,'ea-thickness':0.03,'ea-glow':2.5,'ea-branch':1.2,'ea-jitter':0.5,'ea-hue':0.55,'ea-saturation':0.7,'ea-bgdark':0,'ea-pulse':8,'ea-spread':0.15 },
    { name:"NEON STRIKE", 'ea-arcs':4,'ea-speed':2.5,'ea-thickness':0.025,'ea-glow':1.8,'ea-branch':0.6,'ea-jitter':0.25,'ea-hue':0.9,'ea-saturation':1.2,'ea-bgdark':0,'ea-pulse':4,'ea-spread':0.35 },
    { name:"VOID SPARKS", 'ea-arcs':6,'ea-speed':1,'ea-thickness':0.01,'ea-glow':1,'ea-branch':0.3,'ea-jitter':0.15,'ea-hue':0.7,'ea-saturation':0.5,'ea-bgdark':0.5,'ea-pulse':1,'ea-spread':0.4 },
    { name:"CYBER PULSE", 'ea-arcs':7,'ea-speed':3.5,'ea-thickness':0.018,'ea-glow':2.2,'ea-branch':0.9,'ea-jitter':0.35,'ea-hue':0.5,'ea-saturation':1.5,'ea-bgdark':0,'ea-pulse':6,'ea-spread':0.28 },
    { name:"STATIC FIELD", 'ea-arcs':8,'ea-speed':0.5,'ea-thickness':0.008,'ea-glow':0.8,'ea-branch':0.4,'ea-jitter':0.4,'ea-hue':0.65,'ea-saturation':0.6,'ea-bgdark':0.3,'ea-pulse':0.5,'ea-spread':0.5 },
    { name:"ENERGY WEB", 'ea-arcs':6,'ea-speed':1.5,'ea-thickness':0.012,'ea-glow':1.3,'ea-branch':1,'ea-jitter':0.2,'ea-hue':0.45,'ea-saturation':0.9,'ea-bgdark':0.1,'ea-pulse':2,'ea-spread':0.32 },
    { name:"FIRE BOLTS", 'ea-arcs':4,'ea-speed':2.8,'ea-thickness':0.022,'ea-glow':2,'ea-branch':0.7,'ea-jitter':0.3,'ea-hue':0.05,'ea-saturation':1.3,'ea-bgdark':0,'ea-pulse':4,'ea-spread':0.22 }
  ],
  5: [ // Neon Spokes
    { name:"NEON TUNNEL", 'ns-speed':3,'ns-zoom':1.1,'ns-iterations':40,'ns-complexity':.2,'ns-stepsize':.6,'ns-saturation':.6,'ns-exposure':1000 },
    { name:"HYPERSPACE", 'ns-speed':6,'ns-zoom':1.5,'ns-iterations':60,'ns-complexity':.15,'ns-stepsize':.4,'ns-saturation':.8,'ns-exposure':800 },
    { name:"CRYSTAL MAZE", 'ns-speed':1.5,'ns-zoom':.8,'ns-iterations':50,'ns-complexity':.3,'ns-stepsize':.7,'ns-saturation':.4,'ns-exposure':1200 },
    { name:"RAINBOW RUSH", 'ns-speed':4,'ns-zoom':1.2,'ns-iterations':45,'ns-complexity':.25,'ns-stepsize':.5,'ns-saturation':1.2,'ns-exposure':900 },
    { name:"VOID SPOKES", 'ns-speed':2,'ns-zoom':2,'ns-iterations':30,'ns-complexity':.1,'ns-stepsize':.8,'ns-saturation':.3,'ns-exposure':1500 },
    { name:"ELECTRIC BLUE", 'ns-speed':3.5,'ns-zoom':1,'ns-iterations':55,'ns-complexity':.18,'ns-stepsize':.55,'ns-saturation':.5,'ns-exposure':1100 },
    { name:"FIRE SPIRAL", 'ns-speed':5,'ns-zoom':1.3,'ns-iterations':35,'ns-complexity':.35,'ns-stepsize':.45,'ns-saturation':1.5,'ns-exposure':700 },
    { name:"SLOW DRIFT", 'ns-speed':.8,'ns-zoom':.7,'ns-iterations':70,'ns-complexity':.4,'ns-stepsize':.9,'ns-saturation':.7,'ns-exposure':1300 },
    { name:"WARP DRIVE", 'ns-speed':8,'ns-zoom':1.8,'ns-iterations':25,'ns-complexity':.12,'ns-stepsize':.35,'ns-saturation':1,'ns-exposure':600 }
  ],
  6: [ // Crystal Lattice
    { name:"EMERALD GLOW", 'cl-speed':1,'cl-pathcurve':.15,'cl-stepscale':.6,'cl-swirl':.4,'cl-swirlfreq':.15,'cl-shapesize':.28,'cl-shapemod':.5,'cl-glow':1.2,'cl-colorr':.3,'cl-colorg':1.3,'cl-colorb':1.83,'cl-exposure':50000 },
    { name:"RUBY PULSE", 'cl-speed':.8,'cl-pathcurve':.2,'cl-stepscale':.55,'cl-swirl':.5,'cl-swirlfreq':.12,'cl-shapesize':.32,'cl-shapemod':.6,'cl-glow':1.4,'cl-colorr':0,'cl-colorg':3.5,'cl-colorb':4,'cl-exposure':45000 },
    { name:"DEEP VOID", 'cl-speed':.5,'cl-pathcurve':.08,'cl-stepscale':.7,'cl-swirl':.2,'cl-swirlfreq':.1,'cl-shapesize':.22,'cl-shapemod':.35,'cl-glow':.8,'cl-colorr':4,'cl-colorg':4.2,'cl-colorb':4.5,'cl-exposure':60000 },
    { name:"NEON FLOW", 'cl-speed':1.2,'cl-pathcurve':.18,'cl-stepscale':.5,'cl-swirl':.6,'cl-swirlfreq':.2,'cl-shapesize':.26,'cl-shapemod':.55,'cl-glow':1.5,'cl-colorr':1.57,'cl-colorg':3.14,'cl-colorb':0,'cl-exposure':40000 },
    { name:"BLOOD MOON", 'cl-speed':.7,'cl-pathcurve':.25,'cl-stepscale':.5,'cl-swirl':.8,'cl-swirlfreq':.18,'cl-shapesize':.35,'cl-shapemod':.8,'cl-glow':1,'cl-colorr':0,'cl-colorg':5,'cl-colorb':5.5,'cl-exposure':55000 },
    { name:"ICE CRYSTAL", 'cl-speed':.4,'cl-pathcurve':.1,'cl-stepscale':.65,'cl-swirl':.3,'cl-swirlfreq':.08,'cl-shapesize':.24,'cl-shapemod':.4,'cl-glow':1,'cl-colorr':2.8,'cl-colorg':2.5,'cl-colorb':1,'cl-exposure':50000 },
    { name:"SOLAR FLARE", 'cl-speed':1.5,'cl-pathcurve':.2,'cl-stepscale':.45,'cl-swirl':.7,'cl-swirlfreq':.25,'cl-shapesize':.3,'cl-shapemod':.7,'cl-glow':1.8,'cl-colorr':5.8,'cl-colorg':.5,'cl-colorb':0,'cl-exposure':35000 },
    { name:"GHOST GRID", 'cl-speed':.6,'cl-pathcurve':.12,'cl-stepscale':.7,'cl-swirl':.35,'cl-swirlfreq':.14,'cl-shapesize':.2,'cl-shapemod':.3,'cl-glow':.7,'cl-colorr':3.14,'cl-colorg':3.14,'cl-colorb':3.14,'cl-exposure':65000 },
    { name:"HYPERCUBE", 'cl-speed':1,'cl-pathcurve':.3,'cl-stepscale':.4,'cl-swirl':1,'cl-swirlfreq':.3,'cl-shapesize':.38,'cl-shapemod':1,'cl-glow':1.3,'cl-colorr':0,'cl-colorg':2.09,'cl-colorb':4.19,'cl-exposure':42000 }
  ],
  7: [ // Rainbow Nebula
    { name:"COSMIC BLOOM", 'rn-speed':4,'rn-turbulence':.8,'rn-iterations':2,'rn-scale':5,'rn-detail':.08,'rn-saturation':1.5,'rn-brightness':.05,'rn-hue':1,'rn-exposure':1000 },
    { name:"AURORA WAVE", 'rn-speed':2,'rn-turbulence':1.2,'rn-iterations':2.5,'rn-scale':7,'rn-detail':.06,'rn-saturation':2,'rn-brightness':.07,'rn-hue':2.5,'rn-exposure':800 },
    { name:"VOID STORM", 'rn-speed':6,'rn-turbulence':1.5,'rn-iterations':1.5,'rn-scale':4,'rn-detail':.1,'rn-saturation':.8,'rn-brightness':.03,'rn-hue':4,'rn-exposure':1500 },
    { name:"FIRE NEBULA", 'rn-speed':3,'rn-turbulence':.6,'rn-iterations':3,'rn-scale':6,'rn-detail':.05,'rn-saturation':1.8,'rn-brightness':.06,'rn-hue':5.5,'rn-exposure':900 },
    { name:"ICE GALAXY", 'rn-speed':1.5,'rn-turbulence':.9,'rn-iterations':2.2,'rn-scale':8,'rn-detail':.07,'rn-saturation':1.2,'rn-brightness':.04,'rn-hue':3.2,'rn-exposure':1200 },
    { name:"PSYCHEDELIC", 'rn-speed':5,'rn-turbulence':1.8,'rn-iterations':3.5,'rn-scale':3,'rn-detail':.12,'rn-saturation':2.5,'rn-brightness':.08,'rn-hue':0,'rn-exposure':600 },
    { name:"DEEP SPACE", 'rn-speed':1,'rn-turbulence':.4,'rn-iterations':1.8,'rn-scale':10,'rn-detail':.04,'rn-saturation':.6,'rn-brightness':.02,'rn-hue':4.5,'rn-exposure':2000 },
    { name:"PLASMA BURST", 'rn-speed':8,'rn-turbulence':1,'rn-iterations':2.8,'rn-scale':4.5,'rn-detail':.09,'rn-saturation':2.2,'rn-brightness':.1,'rn-hue':1.5,'rn-exposure':500 },
    { name:"NEON DREAMS", 'rn-speed':3.5,'rn-turbulence':1.3,'rn-iterations':2.3,'rn-scale':5.5,'rn-detail':.075,'rn-saturation':1.7,'rn-brightness':.055,'rn-hue':2,'rn-exposure':1100 }
  ],
  8: [ // Inferno Fire
    { name:"CAMPFIRE", 'fire-height':1,'fire-width':1.2,'fire-intensity':2,'fire-timescale':.5,'fire-sparks':100,'fire-smoke':.8,'fire-noise':5 },
    { name:"INFERNO", 'fire-height':1.8,'fire-width':2,'fire-intensity':4,'fire-timescale':.8,'fire-sparks':150,'fire-smoke':1,'fire-noise':6 },
    { name:"CANDLELIGHT", 'fire-height':.5,'fire-width':.5,'fire-intensity':1.5,'fire-timescale':.3,'fire-sparks':30,'fire-smoke':.3,'fire-noise':4 },
    { name:"WILDFIRE", 'fire-height':1.5,'fire-width':2.5,'fire-intensity':3.5,'fire-timescale':1,'fire-sparks':180,'fire-smoke':1.2,'fire-noise':7 },
    { name:"EMBER GLOW", 'fire-height':.7,'fire-width':1,'fire-intensity':1.2,'fire-timescale':.2,'fire-sparks':50,'fire-smoke':.5,'fire-noise':3 },
    { name:"TORCH", 'fire-height':1.3,'fire-width':.8,'fire-intensity':2.5,'fire-timescale':.6,'fire-sparks':80,'fire-smoke':.6,'fire-noise':5 },
    { name:"BONFIRE", 'fire-height':1.2,'fire-width':1.8,'fire-intensity':3,'fire-timescale':.7,'fire-sparks':120,'fire-smoke':.9,'fire-noise':6 },
    { name:"HELLFIRE", 'fire-height':2,'fire-width':2.8,'fire-intensity':5,'fire-timescale':1.2,'fire-sparks':200,'fire-smoke':1.5,'fire-noise':8 },
    { name:"GHOST FLAME", 'fire-height':1,'fire-width':1.5,'fire-intensity':1.8,'fire-timescale':.4,'fire-sparks':60,'fire-smoke':0,'fire-noise':4 }
  ]
};

const shaderNames = ["PLASMA VORTEX", "COSMIC MANDALA", "DARK TRANSIT", "NEON GRID", "ELECTRIC ARCS", "NEON SPOKES", "CRYSTAL LATTICE", "RAINBOW NEBULA", "INFERNO FIRE"];
const shaderSources = [plasmaVortexShader, cosmicMandalaShader, darkTransitShader, neonGridShader, electricArcsShader, neonSpokesShader, crystalLatticeShader, rainbowNebulaShader, infernoFireShader];

// ============== WEBGL SETUP ==============

const canvas = document.getElementById('glCanvas');
const gl = canvas.getContext('webgl', { antialias: true });

const vertexSrc = `attribute vec2 a_position; void main() { gl_Position = vec4(a_position, 0.0, 1.0); }`;

function compileShader(src, type) {
  const s = gl.createShader(type);
  gl.shaderSource(s, src);
  gl.compileShader(s);
  if (!gl.getShaderParameter(s, gl.COMPILE_STATUS)) {
    console.error('Shader error:', gl.getShaderInfoLog(s));
  }
  return s;
}

let currentShader = 0;
let programs = [];
let uniformsMap = [];

shaderSources.forEach((fragSrc, idx) => {
  const vs = compileShader(vertexSrc, gl.VERTEX_SHADER);
  const fs = compileShader(fragSrc, gl.FRAGMENT_SHADER);
  const prog = gl.createProgram();
  gl.attachShader(prog, vs);
  gl.attachShader(prog, fs);
  gl.linkProgram(prog);
  programs.push(prog);
  
  const unis = {};
  gl.useProgram(prog);
  const numUniforms = gl.getProgramParameter(prog, gl.ACTIVE_UNIFORMS);
  for (let i = 0; i < numUniforms; i++) {
    const info = gl.getActiveUniform(prog, i);
    unis[info.name] = gl.getUniformLocation(prog, info.name);
  }
  uniformsMap.push(unis);
});

const posBuf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, posBuf);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 3,-1, -1,3]), gl.STATIC_DRAW);

function setupAttributes(prog) {
  const aPos = gl.getAttribLocation(prog, 'a_position');
  gl.enableVertexAttribArray(aPos);
  gl.vertexAttribPointer(aPos, 2, gl.FLOAT, false, 0, 0);
}

let mouse = { x: 0, y: 0, down: false };
canvas.addEventListener('mousedown', e => { mouse.down = true; });
canvas.addEventListener('mouseup', e => { mouse.down = false; });
canvas.addEventListener('mousemove', e => {
  const rect = canvas.getBoundingClientRect();
  mouse.x = e.clientX - rect.left;
  mouse.y = rect.height - (e.clientY - rect.top);
});

const resBadge = document.getElementById('res-badge');
function resize() {
  const dpr = Math.min(window.devicePixelRatio || 1, 2);
  const w = canvas.clientWidth * dpr;
  const h = canvas.clientHeight * dpr;
  if (canvas.width !== w || canvas.height !== h) {
    canvas.width = w;
    canvas.height = h;
    gl.viewport(0, 0, w, h);
    resBadge.textContent = Math.round(w) + 'Ã—' + Math.round(h);
  }
}

let isPaused = false;
document.addEventListener('keydown', e => {
  if (e.code === 'Space') { isPaused = !isPaused; e.preventDefault(); }
});

// ============== SLIDER SYSTEM ==============

const sliderConfigs = {
  0: ['pv-arms','pv-spin','pv-tightness','pv-coresize','pv-plasma','pv-tendrils','pv-noisescale','pv-turbulence','pv-pulserate','pv-waves','pv-wavespeed','pv-colormode','pv-hue','pv-coreglow','pv-bloom','pv-zoom'],
  1: ['cm-symmetry','cm-layers','cm-complexity','cm-ringscale','cm-rotspeed','cm-pulsespeed','cm-pulseamt','cm-spiral','cm-glow','cm-falloff','cm-colorcycle','cm-hue','cm-saturation','cm-edgeglow','cm-bloom','cm-zoom'],
  2: ['dt-speed','dt-radius','dt-scoops','dt-detail','dt-orb','dt-brightness','dt-saturation','dt-bgdark'],
  3: ['ng-speed','ng-gridsize','ng-linethick','ng-glow','ng-pulse','ng-depth','ng-hue','ng-saturation','ng-bgdark','ng-scanlines','ng-chromatic'],
  4: ['ea-arcs','ea-speed','ea-thickness','ea-glow','ea-branch','ea-jitter','ea-hue','ea-saturation','ea-bgdark','ea-pulse','ea-spread'],
  5: ['ns-speed','ns-zoom','ns-iterations','ns-complexity','ns-stepsize','ns-saturation','ns-exposure'],
  6: ['cl-speed','cl-pathcurve','cl-stepscale','cl-swirl','cl-swirlfreq','cl-shapesize','cl-shapemod','cl-glow','cl-colorr','cl-colorg','cl-colorb','cl-exposure'],
  7: ['rn-speed','rn-turbulence','rn-iterations','rn-scale','rn-detail','rn-saturation','rn-brightness','rn-hue','rn-exposure'],
  8: ['fire-height','fire-width','fire-intensity','fire-timescale','fire-sparks','fire-smoke','fire-noise']
};

const uniformNames = {
  'cm-symmetry':'u_symmetry','cm-layers':'u_layers','cm-complexity':'u_complexity','cm-ringscale':'u_ringscale',
  'cm-rotspeed':'u_rotspeed','cm-pulsespeed':'u_pulsespeed','cm-pulseamt':'u_pulseamt','cm-spiral':'u_spiral',
  'cm-glow':'u_glow','cm-falloff':'u_falloff','cm-colorcycle':'u_colorcycle','cm-hue':'u_hue','cm-saturation':'u_saturation',
  'cm-edgeglow':'u_edgeglow','cm-bloom':'u_bloom','cm-zoom':'u_zoom',
  'pv-arms':'u_arms','pv-spin':'u_spin','pv-tightness':'u_tightness','pv-coresize':'u_coresize',
  'pv-plasma':'u_plasma','pv-tendrils':'u_tendrils','pv-noisescale':'u_noisescale','pv-turbulence':'u_turbulence',
  'pv-pulserate':'u_pulserate','pv-waves':'u_waves','pv-wavespeed':'u_wavespeed',
  'pv-colormode':'u_colormode','pv-hue':'u_hue','pv-coreglow':'u_coreglow','pv-bloom':'u_bloom','pv-zoom':'u_zoom',
  'dt-speed':'u_speed','dt-radius':'u_radius','dt-scoops':'u_scoops','dt-detail':'u_detail',
  'dt-orb':'u_orb','dt-brightness':'u_brightness','dt-saturation':'u_saturation','dt-bgdark':'u_bgdark',
  'ng-speed':'u_speed','ng-gridsize':'u_gridsize','ng-linethick':'u_linethick','ng-glow':'u_glow',
  'ng-pulse':'u_pulse','ng-depth':'u_depth','ng-hue':'u_hue','ng-saturation':'u_saturation',
  'ng-bgdark':'u_bgdark','ng-scanlines':'u_scanlines','ng-chromatic':'u_chromatic',
  'ea-arcs':'u_arcs','ea-speed':'u_speed','ea-thickness':'u_thickness','ea-glow':'u_glow',
  'ea-branch':'u_branch','ea-jitter':'u_jitter','ea-hue':'u_hue','ea-saturation':'u_saturation',
  'ea-bgdark':'u_bgdark','ea-pulse':'u_pulse','ea-spread':'u_spread',
  'ns-speed':'u_speed','ns-zoom':'u_zoom','ns-iterations':'u_iterations','ns-complexity':'u_complexity',
  'ns-stepsize':'u_stepsize','ns-saturation':'u_saturation','ns-exposure':'u_exposure',
  'cl-speed':'u_speed','cl-pathcurve':'u_pathCurve','cl-stepscale':'u_stepScale',
  'cl-swirl':'u_swirl','cl-swirlfreq':'u_swirlFreq',
  'cl-shapesize':'u_shapeSize','cl-shapemod':'u_shapeMod',
  'cl-glow':'u_glow','cl-colorr':'u_colorR','cl-colorg':'u_colorG','cl-colorb':'u_colorB','cl-exposure':'u_exposure',
  'rn-speed':'u_speed','rn-turbulence':'u_turbulence','rn-iterations':'u_iterations','rn-scale':'u_scale',
  'rn-detail':'u_detail','rn-saturation':'u_saturation','rn-brightness':'u_brightness','rn-hue':'u_hue','rn-exposure':'u_exposure',
  'fire-height':'u_flameHeight','fire-width':'u_flameWidth','fire-intensity':'u_flameIntensity',
  'fire-timescale':'u_timeScale','fire-sparks':'u_sparkCount','fire-smoke':'u_smokeOpacity','fire-noise':'u_noiseOctaves'
};

function updateSlider(id) {
  const el = document.getElementById(id);
  if (!el) return;
  const val = document.getElementById('val-' + id);
  const fill = document.getElementById('fill-' + id);
  const v = parseFloat(el.value);
  const t = (v - parseFloat(el.min)) / (parseFloat(el.max) - parseFloat(el.min));
  if (fill) fill.style.width = (t * 100) + '%';
  if (val) {
    if (id.includes('exposure') || id.includes('iterations') || id.includes('sparks') || id.includes('noise') || id.includes('symmetry') || id.includes('layers') || id.includes('arms')) {
      val.textContent = Math.round(v);
    } else {
      val.textContent = v.toFixed(2);
    }
  }
}

Object.values(sliderConfigs).flat().forEach(id => {
  const el = document.getElementById(id);
  if (el) {
    el.addEventListener('input', () => updateSlider(id));
    updateSlider(id);
  }
});

// ============== PRESET SYSTEM ==============

let currentPresetIndex = [0, 0, 0, 0, 0, 0, 0, 0, 0];
const presetNameEl = document.getElementById('current-preset');
const shaderTypeEl = document.getElementById('shader-type');

function buildPresetButtons() {
  for (let s = 0; s < 9; s++) {
    const container = document.getElementById('presets-' + s);
    if (!container) continue;
    container.innerHTML = '';
    presetsData[s].forEach((preset, idx) => {
      const btn = document.createElement('button');
      btn.className = 'preset-btn' + (idx === 0 ? ' active' : '');
      btn.textContent = preset.name;
      btn.addEventListener('click', () => applyPreset(s, idx));
      container.appendChild(btn);
    });
  }
}

function applyPreset(shader, index) {
  const preset = presetsData[shader][index];
  currentPresetIndex[shader] = index;
  
  Object.keys(preset).forEach(key => {
    if (key === 'name') return;
    const el = document.getElementById(key);
    if (el) {
      el.value = preset[key];
      updateSlider(key);
    }
  });
  
  const container = document.getElementById('presets-' + shader);
  if (container) {
    container.querySelectorAll('.preset-btn').forEach((btn, i) => {
      btn.classList.toggle('active', i === index);
    });
  }
  
  presetNameEl.textContent = preset.name;
}

// ============== SHADER SWITCHING ==============

const shaderBtns = document.querySelectorAll('.shader-btn');
const controlSections = document.querySelectorAll('.controls-section');

function switchShader(index) {
  currentShader = index;
  
  shaderBtns.forEach((btn, i) => btn.classList.toggle('active', i === index));
  controlSections.forEach((sec, i) => sec.classList.toggle('active', i === index));
  
  shaderTypeEl.textContent = shaderNames[index];
  presetNameEl.textContent = presetsData[index][currentPresetIndex[index]].name;
  
  gl.useProgram(programs[index]);
  setupAttributes(programs[index]);
}

shaderBtns.forEach((btn, idx) => {
  btn.addEventListener('click', () => switchShader(idx));
});

// ============== EXPORT ==============

function generateExportCode() {
  const idx = currentShader;
  const name = shaderNames[idx];
  const preset = presetsData[idx][currentPresetIndex[idx]].name;
  
  let code = `// ${name} - Exported from Shader Lab Pro 2.4.1
// Preset: ${preset}
// These presets were created using Shader Lab Pro
//
// Visit this site to edit this code and its presets:
// https://shader-labs-pro-plus.netlify.app
//
// Ready to paste into Shadertoy!

`;
  
  // Add #defines for all current slider values
  sliderConfigs[idx].forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      const v = parseFloat(el.value);
      const defName = id.toUpperCase().replace(/-/g, '_');
      code += `#define ${defName} ${v.toFixed(4)}\n`;
    }
  });
  
  code += '\n';
  
  // Get the shader source and convert for Shadertoy
  let shaderCode = shaderSources[idx];
  
  // Remove the WebGL wrapper parts
  shaderCode = shaderCode.replace(/precision highp float;\n?/g, '');
  shaderCode = shaderCode.replace(/void main\(\) \{ vec4 O; mainImage\(O, gl_FragCoord\.xy\); gl_FragColor = O; \}\n?/g, '');
  
  // Build uniform to define mapping, sorted by length (longest first to avoid partial replacements)
  const replacements = [];
  sliderConfigs[idx].forEach(id => {
    const uniName = uniformNames[id];
    const defName = id.toUpperCase().replace(/-/g, '_');
    replacements.push({ uni: uniName, def: defName });
  });
  
  // Sort by uniform name length descending (replace longer names first)
  replacements.sort((a, b) => b.uni.length - a.uni.length);
  
  // Remove uniform lines
  shaderCode = shaderCode.replace(/uniform float [^;]+;\n?/g, '');
  shaderCode = shaderCode.replace(/uniform vec2 iResolution;\n?/g, '');
  shaderCode = shaderCode.replace(/uniform vec4 iMouse;\n?/g, '');
  shaderCode = shaderCode.replace(/uniform float iTime;\n?/g, '');
  
  // Replace uniform usages with #define names using word boundaries
  replacements.forEach(({ uni, def }) => {
    const regex = new RegExp('\\b' + uni.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'g');
    shaderCode = shaderCode.replace(regex, def);
  });
  
  // Clean up extra newlines
  shaderCode = shaderCode.replace(/\n{3,}/g, '\n\n');
  shaderCode = shaderCode.trim();
  
  code += shaderCode;
  
  return code;
}

const modal = document.getElementById('export-modal');
const codePreview = document.getElementById('code-preview');
const copyBtn = document.getElementById('modal-copy');

document.getElementById('export-btn').addEventListener('click', () => {
  codePreview.textContent = generateExportCode();
  modal.classList.add('active');
});

document.getElementById('modal-close').addEventListener('click', () => modal.classList.remove('active'));
document.getElementById('modal-cancel').addEventListener('click', () => modal.classList.remove('active'));
modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('active'); });

copyBtn.addEventListener('click', () => {
  navigator.clipboard.writeText(codePreview.textContent).then(() => {
    copyBtn.textContent = 'Copied!';
    copyBtn.classList.add('copy-success');
    setTimeout(() => {
      copyBtn.textContent = 'Copy to Clipboard';
      copyBtn.classList.remove('copy-success');
    }, 2000);
  });
});

// ============== RENDER ==============

let lastTime = performance.now();
let accTime = 0;
const fpsEl = document.getElementById('fps');
let fpsAccum = 0, fpsFrames = 0;

function render(now) {
  const dt = (now - lastTime) * 0.001;
  lastTime = now;
  if (!isPaused) accTime += dt;
  
  resize();
  
  const prog = programs[currentShader];
  const unis = uniformsMap[currentShader];
  
  gl.useProgram(prog);
  setupAttributes(prog);
  
  if (unis.iResolution) gl.uniform2f(unis.iResolution, canvas.width, canvas.height);
  if (unis.iTime) gl.uniform1f(unis.iTime, accTime);
  if (unis.iMouse) gl.uniform4f(unis.iMouse, mouse.x, mouse.y, mouse.down ? 1 : 0, 0);
  
  sliderConfigs[currentShader].forEach(id => {
    const el = document.getElementById(id);
    const uniName = uniformNames[id];
    if (el && unis[uniName]) {
      gl.uniform1f(unis[uniName], parseFloat(el.value));
    }
  });
  
  gl.drawArrays(gl.TRIANGLES, 0, 3);
  
  fpsAccum += 1 / Math.max(dt, 0.001);
  fpsFrames++;
  if (fpsFrames >= 10) {
    fpsEl.textContent = (fpsAccum / fpsFrames).toFixed(0);
    fpsAccum = 0;
    fpsFrames = 0;
  }
  
  requestAnimationFrame(render);
}

// ============== INIT ==============

buildPresetButtons();
switchShader(0);
applyPreset(0, 0);
requestAnimationFrame(render);

// ============== AUDIO ==============

const bgm = document.getElementById('bgm');
const audioToggle = document.getElementById('audio-toggle');
const volumeSlider = document.getElementById('volume-slider');
const audioControls = document.getElementById('audio-controls');
let audioPlaying = true;
let audioLoaded = false;

// Check if audio file exists
bgm.addEventListener('canplaythrough', () => {
  audioLoaded = true;
  audioControls.style.display = 'flex';
});

bgm.addEventListener('error', () => {
  audioControls.style.display = 'none';
});

// Start at 40% volume
bgm.volume = 0.4;
bgm.muted = false;

audioToggle.addEventListener('click', () => {
  if (!audioLoaded) return;
  
  if (audioPlaying) {
    bgm.muted = true;
    audioToggle.textContent = 'ðŸ”‡';
    audioToggle.classList.remove('playing');
  } else {
    bgm.muted = false;
    bgm.volume = parseFloat(volumeSlider.value);
    bgm.play().catch(() => {});
    audioToggle.textContent = 'ðŸ”Š';
    audioToggle.classList.add('playing');
  }
  audioPlaying = !audioPlaying;
});

volumeSlider.addEventListener('input', () => {
  bgm.volume = parseFloat(volumeSlider.value);
  if (bgm.volume === 0) {
    audioToggle.textContent = 'ðŸ”‡';
  } else if (audioPlaying) {
    audioToggle.textContent = 'ðŸ”Š';
  }
});

// Try to autoplay at 40% volume
bgm.play().catch(() => {});
</script>
</body>
</html>
